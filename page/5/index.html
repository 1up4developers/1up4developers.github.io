
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>1up4developers</title>
  <meta name="author" content="1up4developers">

  
  <meta name="description" content="Este é um assunto polêmico e que gera muita discussão nos escritórios de TI. Mesmo assim, tendo trabalhado em várias empresas, grandes e pequenas, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://1up4dev.org/page/5/">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/1up4developers" rel="alternate" title="1up4developers" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-6134014-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <img src="/images/logo-1up-small.png" style="float: left; margin-top: 11px; margin-right: 30px;" alt="1up4developers logo">
  <h1><a href="/">1up4developers</a></h1>
  
    <h2>Nadando contra o Waterfall. tail -f /mind/realworld >> /blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/1up4developers" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:1up4dev.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/02/complexidade-nao-escala/">Complexidade Não Escala!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-01T07:00:00-02:00" pubdate data-updated="true">Feb 1<span>st</span>, 2011</time>
        | 
  


  <span class="byline author vcard">Posted by <span class="fn"><a class='author' href='/author/rodrigopanachi/'>Rodrigo Panachi</a></span></span>


        
         | <a href="/2011/02/complexidade-nao-escala/#disqus_thread">Comments</a>
        
      </p>
    
    
      <br/>
      
  
  


<div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://1up4dev.org/2011/02/complexidade-nao-escala/" data-text="Complexidade não escala!" data-via="1up4dev" data-counturl="http://1up4dev.org/2011/02/complexidade-nao-escala/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium" data-href="http://1up4dev.org/2011/02/complexidade-nao-escala/"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false" data-url="http://1up4dev.org/2011/02/complexidade-nao-escala/"></div>
  
</div>

    
  </header>


  <div class="entry-content"><p>Este é um assunto polêmico e que gera muita discussão nos escritórios de TI. Mesmo assim, tendo trabalhado em várias empresas, grandes e pequenas, presenciando vários projetos fracassarem por decisões arquiteturais (as gerenciais não contam nesse contexto), e os mesmos erros sendo cometidos repetidas vezes, sinto-me na obrigação de passar esta experiência e meu ponto de vista.</p>

<h3>Escalabilidade, por definição</h3>

<p>De acordo com a <a href="http://en.wikipedia.org/wiki/Scalability">Wikipedia</a>, <strong>escalabilidade</strong> <em>é uma característica desejável em todo o sistema que indica sua habilidade de manipular uma porção crescente de trabalho de forma uniforme, ou estar preparado para crescer.</em> Em outras palavras, um sistema deve estar preparado para suportar uma demanda crescente.</p>

<p>Pode ser classificada como:</p>

<ul>
<li><p>Carga de escalabilidade: um sistema distribuído deve ser fácil para ser expandido e usar sua gama de recursos para acomodar tanto exigências do mesmo sendo elas pouca ou excessiva.</p></li>
<li><p>Geograficamente escalável: um sistema é geograficamente escalável quando ele mantém sua utilidade e usabilidade, não obstante como são usados os seus recursos.</p></li>
<li><p>Escalabilidade administrativa: não importa a variação de informação que diferentes organizações necessitam compartilhar em um único sistema distribuído, ele deve permanecer fácil de ser usado e gerenciado.</p></li>
<li><p>Escalabilidade funcional: capacidade de melhorar o sistema, adicionando novas funcionalidades com mínimo esforço.</p></li>
</ul>


<p>Pode ser aplicada como:</p>

<ul>
<li><p><strong>Escalabilidade Vertical</strong> (scale up): significa adicionar recursos em um único nó do sistema (mais memória ou um disco rígido mais rápido).</p></li>
<li><p><strong>Escalabilidade Horizontal</strong> (scale out): significa adicionar mais nós ao sistema, tais como adicionar um novo computador com uma aplicação para clusterizar o software. Você pode encontrar escalabilidade horizontal nos sabores <a href="http://pt.wikipedia.org/wiki/Computa%C3%A7%C3%A3o_distribu%C3%ADda">Sistemas Distribuídos</a>, <a href="http://en.wikipedia.org/wiki/Enterprise_JavaBean">Serviços de Componentes</a>, <a href="http://pt.wikipedia.org/wiki/Service-oriented_architecture">SOA</a>, <a href="http://en.wikipedia.org/wiki/System_of_systems">System of Systems</a>, etc.</p></li>
</ul>


<p><a href="http://escalabilidade.com"><img src="/images/uploads/2011/01/scale-up-300x150.png" alt="Escalabilidade" /></a>
Do ponto de vista do custo de desenvolvimento, manutenção e suporte, eu defino escalabilidade como: caro (complexo) vs. barato (simples). Porém, o que é caro nem sempre é bom&hellip; e vice versa.</p>

<h3>Analogias com o mundo real</h3>

<p>Nós gostamos de fazer <a href="http://en.wikipedia.org/wiki/Extreme_programming_practices#System_metaphor">analogias com coisas reais</a>, são ótimas para expressar idéias e facilitar a comunicação.</p>

<p>Call centers, ou centrais de atendimento. Se você mora no Brasil provavelmente já perdeu algumas horas de sua vida pendurado no telefone tentando resolver um problema com sua assinatura de celular, internet, TV, energia elétrica, etc. Mas por que isso acontece?
Provavelmente, essas centrais de atendimento começaram com poucos funcionários, porém foram &ldquo;projetadas&rdquo; para crescer conforme a demanda. Basta contratar mais funcionários, dar treinamento e pronto: mais &ldquo;nós&rdquo; atendendo as requisições. Entretanto, o processo passa a ser mais complexo e mais burocrático, pois é muita informação para disseminar entre os funcionários. Resultado: alto custo para empresa e pouco resultado para os clientes. A espera ainda existe e quando finalmente somos atendidos, a sensação é de estar falando com um robô, que dificilmente entenderá seu problema e dará uma solução padrão ou insatisfatória para o mesmo.</p>

<p><a href="/images/uploads/2011/01/call-center.jpg"><img src="/images/uploads/2011/01/call-center-300x225.jpg" alt="Call Center" /></a></p>

<p>O processo é adequado para escalar a demanda horizontalmente, o que o torna complexo e não garante a qualidade. Vale lembrar que o <a href="http://pt.wikipedia.org/wiki/Sistemas_computacionais">software</a> apenas automatiza ou apóia a realização dos processos reais. Se o processo é complexo, o software será tão complexo quanto (e em alguns casos até mais complexo).</p>

<p>Um exemplo diferente: o <a href="http://pt.wikipedia.org/wiki/Volkswagen_Fusca">Fusca</a>. É um dos carros mais simples que existem, não precisa nem de refrigeração a água. Costuma-se dizer que pode ser consertado com um alicate e um rolo de arame. Seu custo de fabricação seria mínimo se comparado com o custo de um carro popular moderno. Ok, não oferece a mesma segurança, velocidade e conforto de um carro moderno, mas ambos conseguem transportar 5 passageiros ao destino desejado.</p>

<p><a href="/images/uploads/2011/01/fuka_herbie_oval.jpg"><img src="/images/uploads/2011/01/fuka_herbie_oval-300x210.jpg" alt="Fusca" /></a></p>

<p>Mas o que um Fusca têm a ver com escalabilidade? Bem, imagine um congestionamento na véspera de um feriado, por exemplo. Tanto o Fusca quanto o carro moderno ficarão parados na mesma fila de farofeiros. Toda tecnologia, complexidade e custo da fabricação do carro moderno não o livra de um congestionamento. Não há projeto que consiga prever ou contornar esse problema.</p>

<p><a href="/images/uploads/2011/01/baleia1.jpg"><img src="/images/uploads/2011/01/baleia1-300x225.jpg" alt="Twitter" /></a></p>

<p>Voltando para nossa realidade, em certos casos o custo não paga o benefício. Mesmo um sistema bem planejado, distribuído, separado em camadas e serviços independentes, pode não suportar a demanda, seja de carga ou de funcionalidade. O mesmo aconteceria com um sistema mais simples arquiteturalmente, com certeza. Porém, o custo e velocidade de desenvolvimento e manutenção seria bem menor.</p>

<h3>O que fazer então?</h3>

<p>Sistemas precisam evoluir de acordo com a necessidade. <a href="http://merbist.com/2011/01/31/designing-for-scalability/">Projetar um sistema</a> prevendo todos os possíveis &ldquo;casos de uso&rdquo; bem como suas hipotéticas cargas (ou acessos) é uma forte característica do <em>waterfall</em>. Sistemas mais simples arquiteturalmente evoluem mais facilmente, em outras palavras, escalam mais facilmente:</p>

<ul>
<li><p><a href="http://pt.wikipedia.org/wiki/Keep_It_Simple"><strong>Keep it simple, stupid</strong></a>! Soluções simples geralmente custam menos e trazem retorno mais rápido. Qualquer funcionalidade ou recurso que não agregue valor deve ser descartada. Simples assim!</p></li>
<li><p><strong>Simplifique requisitos</strong>. Clientes <em>sem</em> software costumam <em>viajar</em> nos requisitos. Converse, escute e entenda exatamente seus <a href="http://1up4dev.org/2008/11/foco-no-problema/">PROBLEMAS</a>, então <a href="http://pt.wikipedia.org/wiki/YAGNI">negocie</a> e sugira uma SOLUÇÃO simples e rápida. E a <a href="http://pragprog.com/titles/prj/ship-it">entregue</a> logo!</p></li>
<li><p><strong>Busque soluções prontas</strong>. As necessidades dos clientes, em muitos casos, são parecidas. Provavelmente existe alguma solução pronta que você pode entregar para seu cliente ao invés de desenvolver um novo [software que todos conhecem] do zero.</p></li>
<li><p><strong>Otimize sua infra-estrutura</strong>. Procure a melhor forma de deploy da aplicação. Qual hardware é mais adequado, qual sistema operacional e arquitetura. Faça tunning do webserver (workers, pool, memória), módulos e load balance. Utilize uma versão otimizada do interpretador, como o <a href="http://www.rubyenterpriseedition.com/">Ruby Enterprise Edition</a>, <a href="http://www.jruby.org/">JRuby</a> ou <a href="http://rubini.us/">Rubinius</a>.</p></li>
<li><p><strong>Monitore sua aplicação</strong>. Uma vez que esteja em produção, monitore-a em busca de gargalos e possíveis pontos de otimização. Existem várias ferramentas para ajudá-lo nessa tarefa, como o <a href="http://hoptoadapp.com/">Hoptoad</a>, <a href="http://newrelic.com/">NewRelic</a>, ou até mesmo o <a href="http://rubini.us/doc/en/tools/profiler/">Rubinius Profiler</a>.</p></li>
<li><p><strong>Otimize sua aplicação</strong>. O log é seu melhor amigo no desenvolvimento. Não ignore queries demoradas ou que geram <a href="http://rails-bestpractices.com/posts/29-fix-n-1-queries">N+1</a>, otimize-as! Faça <em>profiling</em>, analise e otimize o código. Utilize <em>caching</em> para serviços externos e para páginas. Caching pode ser a melhor alternativa para turbinar sua aplicação, mas use-o com sabedoria. Bancos de dados não devem ser um problema, por isso saiba escolher a melhor distribuição para seu caso. Mesmo que <a href="http://nosql-database.org/">NoSQL</a> esteja na moda, não quer dizer que é a melhor solução para sua aplicação (a menos que seja necessário para o negócio).</p></li>
<li><p><strong>Simplifique o desenvolvimento</strong>. Fameworks ajudam bastante, mas use-os com sabedoria para não inflar o <em>stack</em> da aplicação. Em certas situações, vale mais a pena desenvolver algo simples do zero do que utilizar algo pronto, pesado e que precise ser adaptado para sua necessidade. Escreva menos: quanto menor seu código, mais rápido será sua execução. Camadas são perigosas: evite rodeios e escreva código que realmente interessa. E lembre-se: sempre existe uma ferramenta certa para cada problema.</p></li>
</ul>


<h3>SIMPLIFIQUE!</h3>

<p>Tenha sempre a palavra <a href="http://zenhabits.net/simple-living-manifesto-72-ideas-to-simplify-your-life/"><strong>SIMPLES</strong></a> gravada na sua mente. Se uma coisa exigir muito esforço para ser feita, talvez nem valha a pena. Volte para o início, pense novamente e busque uma ALTERNATIVA mais rápida/fácil/barata. Quanto melhor for sua técnica, melhor serão suas escolhas. <a href="http://blip.tv/file/2733212">Pratique constantemente</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/deploy-de-varias-aplicacoes-no-nginx-passenger-usando-subdomain-ou-suburi/">Deploy De Várias Aplicações No Nginx + Passenger Usando Subdomain Ou Suburi</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-26T08:00:59-02:00" pubdate data-updated="true">Jan 26<span>th</span>, 2011</time>
        | 
  


  <span class="byline author vcard">Posted by <span class="fn"><a class='author' href='/author/rodrigopanachi/'>Rodrigo Panachi</a></span></span>


        
         | <a href="/2011/01/deploy-de-varias-aplicacoes-no-nginx-passenger-usando-subdomain-ou-suburi/#disqus_thread">Comments</a>
        
      </p>
    
    
      <br/>
      
  
  


<div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://1up4dev.org/2011/01/deploy-de-varias-aplicacoes-no-nginx-passenger-usando-subdomain-ou-suburi/" data-text="Deploy de várias aplicações no Nginx + Passenger usando subdomain ou suburi" data-via="1up4dev" data-counturl="http://1up4dev.org/2011/01/deploy-de-varias-aplicacoes-no-nginx-passenger-usando-subdomain-ou-suburi/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium" data-href="http://1up4dev.org/2011/01/deploy-de-varias-aplicacoes-no-nginx-passenger-usando-subdomain-ou-suburi/"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false" data-url="http://1up4dev.org/2011/01/deploy-de-varias-aplicacoes-no-nginx-passenger-usando-subdomain-ou-suburi/"></div>
  
</div>

    
  </header>


  <div class="entry-content"><p>Se você está pensando em fazer o deploy da sua aplicação Rails em um server <a href="http://nginx.org/">Nginx</a> com <a href="http://www.modrails.com/">Phusion Passenger</a>, você está no caminho certo! Não apenas pela segurança e performance do Nginx, mas também pela facilidade de instalação e configuração quando comparado à outros web servers populares.</p>

<p>A <a href="http://wiki.nginx.org/Install">instalação do Nginx</a> bem como <a href="http://www.modrails.com/install.html">configuração do módulo do Passenger</a> são relativamente simples. A documentação de <a href="http://www.modrails.com/documentation/Users%20guide%20Nginx.html#_installing_phusion_passenger">ambos é bem completa</a>. Você provavelmente não terá muita dificuldade. Eu recomendo seguir o passo-a-passo da instalação do Passenger:</p>

<pre><code>  passenger-install-nginx-module
</code></pre>

<p>Uma vez que tudo esteja instalado, é hora de configurar o Nginx editando o arquivo <code>nginx.conf</code> (provavelmente localizado em <code>/usr/local/nginx/conf/nginx.conf</code>)</p>

<h3>Usando sub URI</h3>

<p>O deploy como sub URI torna sua aplicação acessível com o endereço <code>http://dominio.com/app1</code>, sendo <code>app1</code> o nome da sua aplicação. Supondo que diretório público do Nginx esteja em <code>/var/www</code> e sua aplicação Rails em <code>/var/rails/app1</code>, configure-o assim:</p>

<pre><code>http {
    ...
    server {
        listen 80;
        server_name dominio.com www.dominio.com;
        root /var/www;
        passenger_enabled on;
        passenger_base_uri /app1;
    }
    ...
}
</code></pre>

<p>Ainda é preciso criar um link simbólico para que o contexto da aplicação Rails seja visível pelo document root em <code>/var/www</code>:</p>

<pre><code>ln -s /var/rails/app1/public /var/www/app1
</code></pre>

<p>Reiniciando o Nginx, sua aplicação já estará rodando. Para adicionar outras aplicações, basta adicionar:</p>

<pre><code>        passenger_base_uri /app1;
        passenger_base_uri /app2;
        passenger_base_uri /app3;
</code></pre>

<p>E em seguida criar os links simbólicos como descrito acima. Nota importante: em alguns casos, será necessário informar a URL relativa correta nas configurações do Rails:</p>

<pre><code>   config.action_controller.relative_url_root = "/app1"
</code></pre>

<h3>Usando subdomain</h3>

<p>O deploy como subdomain torna sua aplicação acessível com o endereço <code>http://app1.dominio.com</code>. Basta configurar o Nginx como segue:</p>

<pre><code>http {
    ...
    server {
        listen 80;
        server_name app1.dominio.com;
        root /var/rails/app1/public;
        passenger_enabled on;
    }
    ...
}
</code></pre>

<p>Note que o <code>root</code> aponta diretamente para o diretório &ldquo;public&rdquo; da aplicação Rails. Para fazer o deploy de outras aplicações como subdomínio, basta configurar outro &ldquo;server&rdquo;, alterando <code>root</code> e o <code>server_name</code>:</p>

<pre><code>http {
    ...
    server {
        listen 80;
        server_name app1.dominio.com;
        root /var/rails/app1/public;
        passenger_enabled on;
    }
    ...
    server {
        listen 80;
        server_name app2.dominio.com;
        root /var/rails/app2/public;
        passenger_enabled on;
    }
    ...
}
</code></pre>

<p>Uma vez que o DNS do host esteja corretamente configurado, suas aplicações estarão acessíveis em <code>http://app1.dominio.com</code>, <code>http://app2.dominio.com</code>, etc.</p>

<p>Dúvidas ou sugestões, utilizem os comentários. Sucesso!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/enviando-emails-no-rails-atraves-do-gmail/">Enviando Emails No Rails Através Do Gmail</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-20T07:00:09-02:00" pubdate data-updated="true">Jan 20<span>th</span>, 2011</time>
        | 
  


  <span class="byline author vcard">Posted by <span class="fn"><a class='author' href='/author/rodrigopanachi/'>Rodrigo Panachi</a></span></span>


        
         | <a href="/2011/01/enviando-emails-no-rails-atraves-do-gmail/#disqus_thread">Comments</a>
        
      </p>
    
    
      <br/>
      
  
  


<div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://1up4dev.org/2011/01/enviando-emails-no-rails-atraves-do-gmail/" data-text="Enviando emails no Rails através do Gmail" data-via="1up4dev" data-counturl="http://1up4dev.org/2011/01/enviando-emails-no-rails-atraves-do-gmail/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium" data-href="http://1up4dev.org/2011/01/enviando-emails-no-rails-atraves-do-gmail/"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false" data-url="http://1up4dev.org/2011/01/enviando-emails-no-rails-atraves-do-gmail/"></div>
  
</div>

    
  </header>


  <div class="entry-content"><p>Enviar emails de uma aplicação Rails é <a href="http://guides.rubyonrails.org/action_mailer_basics.html">muito simples</a>. A parte complicada fica com a configuração do ambiente e do servidor de email. Se você não souber ou não tiver muita paciência para fazer isso (por exemplo instalar e configurar <a href="http://www.sendmail.org">sendmail</a>, <a href="http://www.mutt.org/">mutt</a>, etc), pode facilmente usar sua conta do <a href="http://lindsaar.net/2010/3/15/how_to_use_mail_and_actionmailer_3_with_gmail_smtp">Gmail</a> para enviar as mensagens da sua aplicação.</p>

<p>Basta incluir as seguintes configurações no bloco <code>config</code> dos respectivos ambientes da aplicação (por exemplo, <code>config/environments/production.rb</code>):</p>

<pre><code>  config.action_mailer.delivery_method = :smtp
  config.action_mailer.smtp_settings = {
    :enable_starttls_auto =&gt; true,
    :authentication =&gt; :plain,
    :address =&gt; smtp.gmail.com,
    :port =&gt; 587,
    :user_name =&gt; "seuemail@gmail.com",
    :password =&gt; "suasenha"
  }
</code></pre>

<p>O toque mágico é a chave <code>:enable_startls_auto =&gt; true</code> para habilitar <a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a>. Sucesso!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/criando-um-webcrawler-de-modo-facil-e-rapido-com-ruby-e-nokogiri/">Criando Um WebCrawler De Modo Fácil E Rápido Com Ruby E Nokogiri</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-18T07:00:41-02:00" pubdate data-updated="true">Jan 18<span>th</span>, 2011</time>
        | 
  


  <span class="byline author vcard">Posted by <span class="fn"><a class='author' href='/author/rodrigopanachi/'>Rodrigo Panachi</a></span></span>


        
         | <a href="/2011/01/criando-um-webcrawler-de-modo-facil-e-rapido-com-ruby-e-nokogiri/#disqus_thread">Comments</a>
        
      </p>
    
    
      <br/>
      
  
  


<div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://1up4dev.org/2011/01/criando-um-webcrawler-de-modo-facil-e-rapido-com-ruby-e-nokogiri/" data-text="Criando um WebCrawler de modo fácil e rápido com Ruby e Nokogiri" data-via="1up4dev" data-counturl="http://1up4dev.org/2011/01/criando-um-webcrawler-de-modo-facil-e-rapido-com-ruby-e-nokogiri/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium" data-href="http://1up4dev.org/2011/01/criando-um-webcrawler-de-modo-facil-e-rapido-com-ruby-e-nokogiri/"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false" data-url="http://1up4dev.org/2011/01/criando-um-webcrawler-de-modo-facil-e-rapido-com-ruby-e-nokogiri/"></div>
  
</div>

    
  </header>


  <div class="entry-content"><p>Quantas vezes você precisou buscar alguma informação externa para sua aplicação, como um número de telefone ou uma foto em algum site? A idéia é simples: criar um <a href="http://en.wikipedia.org/wiki/Web_crawler">crawler</a> script para fazer parse de algum conteúdo HTML. E basta apenas Ruby e <a href="http://nokogiri.org/">Nokogiri</a>.</p>

<h3>Exemplo</h3>

<p>Digamos que eu queira obter a última versão de uma dada gem consultando diretamente no site <a href="http://rubygems.org/">http://rubygems.org</a> para me ajudar quando precisar instalar novas gems no meu ambiente. Vamos ao código:</p>

<pre><code>#!/usr/bin/env ruby

require "rubygems"
require "open-uri"
require "nokogiri"

gem = ARGV[0]
site = open("http://rubygems.org/gems/#{gem}")
document = Nokogiri::HTML(site)
version = document.css(".title h3").text

puts "#{gem} version #{version}"
</code></pre>

<p>Vou salvar esse script no arquivo <code>gem-version.sh</code>, torna-lo executável com <code>chmod +x gem-version.sh</code> em seguida executar no terminal:</p>

<pre><code>$ ./gem-version rails
  rails version 3.0.3
</code></pre>

<p>Pronto, agora você também pode brincar à vontade com <a href="http://github.com/tenderlove/nokogiri">Nokogiri</a> no seu shell!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/usando-bundler-com-rails-2-3/">Usando Bundler Com Rails 2.3</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-17T09:00:55-02:00" pubdate data-updated="true">Jan 17<span>th</span>, 2011</time>
        | 
  


  <span class="byline author vcard">Posted by <span class="fn"><a class='author' href='/author/pbalduino/'>Plínio Balduino</a></span></span>


        
         | <a href="/2011/01/usando-bundler-com-rails-2-3/#disqus_thread">Comments</a>
        
      </p>
    
    
      <br/>
      
  
  


<div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://1up4dev.org/2011/01/usando-bundler-com-rails-2-3/" data-text="Usando Bundler com Rails 2.3" data-via="1up4dev" data-counturl="http://1up4dev.org/2011/01/usando-bundler-com-rails-2-3/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium" data-href="http://1up4dev.org/2011/01/usando-bundler-com-rails-2-3/"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false" data-url="http://1up4dev.org/2011/01/usando-bundler-com-rails-2-3/"></div>
  
</div>

    
  </header>


  <div class="entry-content"><p>Iniciando minha participação neste blog, vou apresentar uma solução rápida para um problema que eu tive e levei um certo tempo para encontrar uma resposta.</p>

<p>Caso você não conheça, Bundler é uma ferramenta criada para facilitar a instalação e atualização de aplicações e suas gems, resolvendo facilmente as dependências e criando ambientes homogêneos em máquinas diferentes. Em outras palavras, resolve de uma vez por todas aquele inferno que era ter que baixar gem por gem da sua aplicação e ainda assim correr o risco de encontrar alguma incompatibilidade.</p>

<p>O Rails 3 utiliza o Bundler por padrão, mas aplicações em Rails 2.x ainda dependem das gems declaradas no arquivo <code>config/environment.rb</code>, e ao copiar os arquivos para uma determinada máquina, você é obrigado a usar <code>rake gems:install</code>, que vai levar algum tempo rodando e não vai instalar tudo o que você precisa.</p>

<p>Ou pelo menos era assim que funcionava até você ler esse post.</p>

<p>Primeiro, considerando que você esteja no diretório raiz da sua aplicação, execute a sequência abaixo:</p>

<p>Antes de qualquer outra coisa, instale o Bundler na sua máquina executando o comando <code>gem install bundler</code></p>

<p>No seu arquivo <code>config/boot.rb</code>, imediatamente antes da linha <code>Rails.boot!</code>, insira o bloco abaixo:</p>

<pre><code>class Rails::Boot
  def run
    load_initializer

    Rails::Initializer.class_eval do
      def load_gems
        @bundler_loaded ||= Bundler.require :default, Rails.env
      end
    end

    Rails::Initializer.run(:set_load_path)
  end
end
</code></pre>

<p>Crie um arquivo <code>config/preinitializer.rb</code>. Esse arquivo não existe no Rails 2.x, então se você não criar, não vai funcionar. Adicione as linhas abaixo nesse arquivo:</p>

<pre><code>begin
  require "rubygems"
  require "bundler"
rescue LoadError
  raise "Could not load the bundler gem. Install it with `gem install bundler`."
end

if Gem::Version.new(Bundler::VERSION) &lt;= Gem::Version.new("0.9.24")
  raise RuntimeError, "Your bundler version is too old for Rails 2.3." +
   "Run `gem install bundler` to upgrade."
end

begin
  # Set up load paths for all bundled gems
  ENV["BUNDLE_GEMFILE"] = File.expand_path("../../Gemfile", __FILE__)
  Bundler.setup
rescue Bundler::GemNotFound
  raise RuntimeError, "Bundler couldn't find some gems." +
    "Did you run `bundle install`?"
end
</code></pre>

<p>Crie um arquivo chamado <code>Gemfile</code> no raiz da sua aplicação. Entre em <code>config/environment.rb</code>, remova todas as instruções config.gem e as adicione no arquivo <code>Gemfile</code> conforme abaixo, sem o prefixo <code>config.</code> (ponto incluído).</p>

<p>Seu arquivo <code>config/environment.rb</code> era assim:</p>

<pre><code># Be sure to restart your server when you modify this file

# Specifies gem version of Rails to use when vendor/rails is not present
RAILS_GEM_VERSION = '2.3.10' unless defined? RAILS_GEM_VERSION

# Bootstrap the Rails environment, frameworks, and default configuration
require File.join(File.dirname(__FILE__), 'boot')

Rails::Initializer.run do |config|
  # Settings in config/environments/* take precedence over those specified here.
  # Application configuration should go into files in config/initializers
  # -- all .rb files in that directory are automatically loaded.

  # Add additional load paths for your own custom dirs
  # config.load_paths += %W( #{RAILS_ROOT}/extras )

  # Specify gems that this application depends on and have them installed with rake gems:install
  config.gem "bj"
  config.gem "hpricot", :version =&gt; '0.6', :source =&gt; "http://code.whytheluckystiff.net"
  config.gem "sqlite3-ruby", :lib =&gt; "sqlite3"
  config.gem "aws-s3", :lib =&gt; "aws/s3"
  config.gem "authlogic", :version =&gt; "=2.1.6"
  config.gem "slim_scrooge", "=1.0.10"

  # Only load the plugins named here, in the order given (default is alphabetical).
  # :all can be used as a placeholder for all plugins not explicitly named
  # config.plugins = [ :exception_notification, :ssl_requirement, :all ]

  # Skip frameworks you're not going to use. To use Rails without a database,
  # you must remove the Active Record framework.
  # config.frameworks -= [ :active_record, :active_resource, :action_mailer ]
end
</code></pre>

<p>E agora é assim:</p>

<pre><code># Be sure to restart your server when you modify this file

# Specifies gem version of Rails to use when vendor/rails is not present
RAILS_GEM_VERSION = '2.3.10' unless defined? RAILS_GEM_VERSION

# Bootstrap the Rails environment, frameworks, and default configuration
require File.join(File.dirname(__FILE__), 'boot')

Rails::Initializer.run do |config|
  # Settings in config/environments/* take precedence over those specified here.
  # Application configuration should go into files in config/initializers
  # -- all .rb files in that directory are automatically loaded.

  # Add additional load paths for your own custom dirs
  # config.load_paths += %W( #{RAILS_ROOT}/extras )

  # Only load the plugins named here, in the order given (default is alphabetical).
  # :all can be used as a placeholder for all plugins not explicitly named
  # config.plugins = [ :exception_notification, :ssl_requirement, :all ]

  # Skip frameworks you're not going to use. To use Rails without a database,
  # you must remove the Active Record framework.
  # config.frameworks -= [ :active_record, :active_resource, :action_mailer ]
end
</code></pre>

<p>Bem mais limpo, não?</p>

<p>Já o seu recém criado arquivo <code>Gemfile</code> vai ficar assim:</p>

<pre><code>source 'http://gemcutter.org'
gem "bj"
gem "hpricot", "~&gt; 0.6"
gem "sqlite3-ruby", "~&gt; 1.3.1", :require =&gt; "sqlite3"
gem "aws-s3", :lib =&gt; "aws/s3"
gem "rails", "= 2.3.10"
gem "authlogic", "~&gt; 2.1.6"

group :development, :test do
  gem 'mongrel', :require =&gt; false
end

group :production do
  gem "slim_scrooge", "~&gt; 1.0.10"
end
</code></pre>

<p>Note que eu criei dois grupos: um com <code>:development, :test</code> e um com <code>:production</code>. Significa que as gems do primeiro grupo somente serão utilizadas em desenvolvimento e em testes, e as do segundo grupo somente serão usadas no ambiente de produção. O que está fora dos grupos será usado em qualquer ambiente.</p>

<p>Agora, finalmente você digita <code>bundle install</code>, aguarda alguns instantes e pronto! A sua aplicação está com todas as gems instaladas e suas devidas dependências.</p>

<p>Para listar as gems utilizadas, execute <code>bundle list</code>.</p>

<p>Sugestões, correções e críticas são bem vindas nos comentários.</p>

<p>Para mais informações, leia a documentação no site do Bundle: <a href="http://gembundler.com/">http://gembundler.com/</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/voltamos/">Voltamos!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-17T08:00:23-02:00" pubdate data-updated="true">Jan 17<span>th</span>, 2011</time>
        | 
  


  <span class="byline author vcard">Posted by <span class="fn"><a class='author' href='/author/rodrigopanachi/'>Rodrigo Panachi</a></span></span>


        
         | <a href="/2011/01/voltamos/#disqus_thread">Comments</a>
        
      </p>
    
    
      <br/>
      
  
  


<div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://1up4dev.org/2011/01/voltamos/" data-text="Voltamos!" data-via="1up4dev" data-counturl="http://1up4dev.org/2011/01/voltamos/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium" data-href="http://1up4dev.org/2011/01/voltamos/"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false" data-url="http://1up4dev.org/2011/01/voltamos/"></div>
  
</div>

    
  </header>


  <div class="entry-content"><p>Caros leitores, depois de um período, digamos <em>boring</em>, estamos de volta e com novidades!</p>

<p>Durante o ano de 2010 estivemos trabalhando muito, por isso a baixa frequencia de posts. Porém tanto trabalho rendeu experiências únicas para todos nós, as quais pretendemos compartilhar com vocês em breve.</p>

<h2>Novos rebeldes colaboradores</h2>

<p><a href="http://twitter.com/habutre">Rogério Ramos</a></p>

<p>Desenvolvedor, entusiasta, sonhador. Acredita que desenvolvedores e usuários devem trabalhar sempre a quatro mãos. Veterano com agile e Scrum, está iniciando sua jornada com com Ruby on Rails.</p>

<p><a href="http://twitter.com/p_balduino">Plínio Balduino</a></p>

<p>Desenvolvedor, baixista musicólatra, test addicted, viciado em leitura, &ldquo;pragmático, sarcástico, curioso&rdquo; e pai do Gustavinho. Esperem posts ácidos sobre Scrum e dicas práticas de Rails.</p>

<p>Sejam bem vindos à <a href="http://1up4dev.org/1up-nightmare-team/">guerrilha</a>!</p>

<h2>E não é só isso!</h2>

<p>Estreiamos o novo tema, mais limpo e distribuído, facilitando a leitura dos códigos inline. O endereço do feed também mudou: atualizem seus leitores para o endereço <a href="http://feeds.feedburner.com/1up4developers">http://feeds.feedburner.com/1up4developers</a>. E quem ainda não assinou, assine <em>d-já</em>!</p>

<p>Fiquem a vontade para comentar (ou não). Sucesso!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/08/teste-de-integracao-com-rspec-1-x-e-capybara-na-sua-app-rails/">Teste De Integração Com Rspec 1.x E Capybara Na Sua App Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-09T07:00:35-03:00" pubdate data-updated="true">Aug 9<span>th</span>, 2010</time>
        | 
  


  <span class="byline author vcard">Posted by <span class="fn"><a class='author' href='/author/rogerbarreto/'>Roger Leite</a></span></span>


        
         | <a href="/2010/08/teste-de-integracao-com-rspec-1-x-e-capybara-na-sua-app-rails/#disqus_thread">Comments</a>
        
      </p>
    
    
      <br/>
      
  
  


<div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://1up4dev.org/2010/08/teste-de-integracao-com-rspec-1-x-e-capybara-na-sua-app-rails/" data-text="Teste de integração com Rspec 1.x e Capybara na sua app Rails" data-via="1up4dev" data-counturl="http://1up4dev.org/2010/08/teste-de-integracao-com-rspec-1-x-e-capybara-na-sua-app-rails/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium" data-href="http://1up4dev.org/2010/08/teste-de-integracao-com-rspec-1-x-e-capybara-na-sua-app-rails/"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false" data-url="http://1up4dev.org/2010/08/teste-de-integracao-com-rspec-1-x-e-capybara-na-sua-app-rails/"></div>
  
</div>

    
  </header>


  <div class="entry-content"><p>Este não é daqueles posts que explicam o que é rspec, testes, diferenças entre teste funcional, integração e etc. Este post é só uma rapidinha, pra quem já conhece <a href="http://rspec.info/">rspec</a> e <a href="http://github.com/jnicklas/capybara">capybara</a>.</p>

<p>A documentação do Capybara é boa, mas deixa a desejar nas instruções de como integrá-lo somente com rspec. Com a ajuda do <a href="http://blog.georgeguimaraes.com/">George Guimarães</a> da <a href="http://blog.plataformatec.com.br/">Plataforma</a>, cheguei num passo a passo mega simples.</p>

<p>No <em>config/environments/test.rb</em> declare:</p>

<pre><code>config.gem "rspec",            :version =&gt; "= 1.3.0", :lib =&gt; false
config.gem "rspec-rails",      :version =&gt; "= 1.3.2", :lib =&gt; false
config.gem "capybara",         :version =&gt; "= 0.3.9", :lib =&gt; false
</code></pre>

<p>No <em>spec/spec_helper.rb</em> coloque:</p>

<pre><code>require 'capybara/rails'
[...]
Spec::Runner.configure do |config|

  [...]
  config.include(Capybara, :type =&gt; :integration)

end
</code></pre>

<p>Pronto! Isto é o suficiente para utilizar o Capybara nos testes de integração.
Para finalizar, você pode montar um teste simples de validação. Por exemplo:</p>

<p>Crie <em>spec/integration/site_spec.rb</em> e coloque:</p>

<pre><code>require 'spec_helper'

describe "Site sample" do

  context "root" do

    before do
      visit root_url
      save_and_open_page
    end

    it "should have Hello" do
      page.should have_content("Hello")
    end

  end

end
</code></pre>

<p>Para executar somente os testes de integração:</p>

<pre><code>rake spec:integration
</code></pre>

<h2>have_content e um hot tip que pode te salvar muitas horas !</h2>

<p>Caso aconteça o erro:</p>

<pre><code>undefined method `have_content' for #&lt;ActionController::Integration::Session:0xb618ad10&gt;
</code></pre>

<p>Graças a esta mensagem <a href="http://groups.google.com/group/ruby-capybara/browse_thread/thread/28467e031beb7ba1/19a368c21a278eb8?lnk=gst&amp;q=have_content#19a368c21a278eb8">Can&rsquo;t make matchers work with cucumber and rails 2.3.2</a>, descobri que o <em>have_content</em> não funciona com o rails 2.3.2, eu resolvi o problema fazendo um upgrade para a última versão do rails. #ficaadica</p>

<p>Dúvidas, melhorias, sugestões e elogios são sempre bem vindos !</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/07/a-extincao-do-programador-senior/">A Extinção Do Programador Sênior</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-07-29T01:21:38-03:00" pubdate data-updated="true">Jul 29<span>th</span>, 2010</time>
        | 
  


  <span class="byline author vcard">Posted by <span class="fn"><a class='author' href='/author/hbulhoes/'>Humberto Bulhões</a></span></span>


        
         | <a href="/2010/07/a-extincao-do-programador-senior/#disqus_thread">Comments</a>
        
      </p>
    
    
      <br/>
      
  
  


<div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://1up4dev.org/2010/07/a-extincao-do-programador-senior/" data-text="A extinção do programador sênior" data-via="1up4dev" data-counturl="http://1up4dev.org/2010/07/a-extincao-do-programador-senior/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium" data-href="http://1up4dev.org/2010/07/a-extincao-do-programador-senior/"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false" data-url="http://1up4dev.org/2010/07/a-extincao-do-programador-senior/"></div>
  
</div>

    
  </header>


  <div class="entry-content"><p>Quando foi a última vez em que você viu um programador sênior? Eu tenho tido sérias dificuldades para encontrar algum. Acho que se estivesse procurando ararinhas azuis teria tido mais sucesso &mdash; será que alguma toparia programar? Desconfio que não. Consciente da causa ecológica, ela me diria: cada ararinha programando toma o lugar de um programador sênior, que é de uma espécie muito mais em risco do que eu. E bateria as asas em retirada.</p>

<p>É claro que, ao contrário da <a href="http://pt.wikipedia.org/wiki/Ararinha-azul">pobre arara</a>, o programador sênior ainda existe, e em grandes quantidades. Mas algo deu errado na evolução da sua espécie que, ao invés de melhorar, foi substituída por uma variedade mais fácil de reproduzir, bem adaptada ao cativeiro, de comportamento dócil, capaz de passar anos fazendo a mesma coisa e com duas opções de cor: terno preto ou azul. E que, curiosamente, não consegue programar. Eu já vou batizando essa variedade de <em>programador senhor</em>.</p>

<p>Estou falando por experiência própria. A <a href="http://www.alohapos.com.br/">empresa em que eu trabalho</a> está recrutando um &ldquo;programador sênior&rdquo; há alguns meses. Dada a indisponibilidade dos colegas no nosso <em>networking</em> (o que nos pouparia um grande tempo), resolvemos apelar e buscar no mercadão de trabalho (vulgo apinfo, catho, essas coisas). Nós filtramos dezenas de currículos, conduzimos entrevistas, aplicamos testes. Com isso, conseguimos achar diversos programadores <em>senhores</em> mas nenhum propriamente <em>sênior</em>. A maioria tinha 10+ anos de carreira, 30+ anos de idade e -1 noção para bolar respostas satisfatórias para questões como:</p>

<ol>
<li><p> Como dois programas podem se comunicar?</p></li>
<li><p> O que são threads?</p></li>
<li><p> Implemente o <a href="http://imranontech.com/2007/01/24/using-fizzbuzz-to-find-developers-who-grok-coding/">fizz buzz</a> na linguagem que preferir.</p></li>
</ol>


<p>E assim por diante. Nada muito específico: preferimos encontrar gente que tivesse convivido com certos problemas, independente da tecnologia adotada. Gente demonstrasse <em>senioridade</em> propriamente dita: maturidade, bom senso, raciocínio, segurança. E conhecimento suficiente para não achar que a chave de todos os problemas é uma consulta ao Google (houve quem confessasse isso). Não encontramos essa gente ainda, mas em compensação vimos muitas pessoas bem intencionadas, certamente esforçadas, mas com imensas dificuldades para concatenar opiniões a respeito de conceitos que julgamos básicos e, no nosso negócio, fundamentais.</p>

<p>Sequer exigimos que o candidato conheça tópicos como controle de versão, orientação a objetos, design patterns, agilidade e etcetera, que são sinais mais do que evidentes de maturidade. Já entendemos que tudo isso está além dos limites do habitat do programador senhor. São coisas tão exóticas quanto um programador sênior genuíno, que só deve existir em áreas de proteção ambiental, como este blog.</p>

<p>(Às araras azuis que estiverem interessadas no recrutamento: por ora concluímos o processo, mas não deixem de <a href="mailto:humberto.bulhoes@gmail.com">entrar em contato</a>.)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/07/gerando-rotas-com-parametros-dinamicos-no-rails-de-modo-facil/">Gerando Rotas Com Parâmetros Dinâmicos No Rails De Modo Fácil</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-07-02T06:00:23-03:00" pubdate data-updated="true">Jul 2<span>nd</span>, 2010</time>
        | 
  


  <span class="byline author vcard">Posted by <span class="fn"><a class='author' href='/author/rodrigopanachi/'>Rodrigo Panachi</a></span></span>


        
         | <a href="/2010/07/gerando-rotas-com-parametros-dinamicos-no-rails-de-modo-facil/#disqus_thread">Comments</a>
        
      </p>
    
    
      <br/>
      
  
  


<div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://1up4dev.org/2010/07/gerando-rotas-com-parametros-dinamicos-no-rails-de-modo-facil/" data-text="Gerando rotas com parâmetros dinâmicos no Rails de modo fácil" data-via="1up4dev" data-counturl="http://1up4dev.org/2010/07/gerando-rotas-com-parametros-dinamicos-no-rails-de-modo-facil/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium" data-href="http://1up4dev.org/2010/07/gerando-rotas-com-parametros-dinamicos-no-rails-de-modo-facil/"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false" data-url="http://1up4dev.org/2010/07/gerando-rotas-com-parametros-dinamicos-no-rails-de-modo-facil/"></div>
  
</div>

    
  </header>


  <div class="entry-content"><p>A <a href="http://api.rubyonrails.org/classes/ActionController/Routing.html">API de rotas</a> do Rails simplifica consideravelmente o desenvolvimento fornecendo um padrão de geração e utilização de URLs para toda aplicação. Porém algumas necessidades especificas e relativamente simples podem gerar dores de cabeça se forem implementadas incorretamente.</p>

<p>Um caso bastante comum são URLs compostas que sempre apontam para um mesmo recurso. Por exemplo, um blog que possua rotas para seus posts no formato <code>/posts/autor/categoria/permalink</code> provavelmente terá uma rota mapeada como <code>map.post "posts/:author/:category/:permalink"</code> gerando automaticamente os helpers <code>post_path</code> e <code>post_url</code>.</p>

<p>Muito bom, porém para <a href="http://guides.rubyonrails.org/routing.html#generating-urls-from-code">usufruirmos desta facilidade</a> precisamos fornecer os valores dos parâmetros dinâmicos nos <em>controllers</em> e <em>views</em>:</p>

<pre><code>post_path(:author =&gt; @post.author, :category =&gt; @post.category, :permalink =&gt; @post.permalink)
</code></pre>

<p>E mesmo que você forneça os <a href="http://guides.rubyonrails.org/routing.html#route-generation-from-arrays">parâmetros em um array</a>, vai dar muito trabalho além de deixar muito código repetido pela aplicação.</p>

<h2>Entendi! Mas como resolvo este problema?</h2>

<p>Para este caso, apenas implementar o método <code>[to_param](http://api.rubyonrails.org/classes/ActiveRecord/Base.html#M001840)</code> do model não vai servir. Uma solução seria reescrever o método <code>post_path</code> (que é gerado automaticamente) no respectivo helper (posts_helper.rb):</p>

<pre><code>def post_path(post, options = {})
  super(post, :author =&gt; post.author, :category =&gt; post.category, :permalink =&gt; post.permalink)
end
</code></pre>

<p>Outra solução seria sobrescrever o método <code>[default_url_options](http://api.rubyonrails.org/classes/ActionController/Base.html#M000467)</code> no <em>controller</em> para retorna os parâmetros padrões da rota:</p>

<pre><code>def default_url_options(options = {})
  options.merge!(:author =&gt; @post.author, :category =&gt; @post.category, :permalink =&gt; @post.permalink) if options[:action] == "show"
end
</code></pre>

<p>A má notícia é que você terá que fazer isto para todos seus controllers e respectivos models.</p>

<p>A terceira solução (e mais elegante) é padronizar a maneira com que os parâmetros opcionais da rota são obtidos a partir do controller e seu respectivo model. Basta adicionar os seguintes métodos no seu <em>ApplicationController</em>:</p>

<pre><code>def default_url_options(options = {})
  if (model = controller_model(options))
    dynamic_route_params(options).each do |param|
      options[param] = model.send(param) if model.respond_to?(param)
    end
  end
  options
end

def controller_model(options = {})
  clazz = (options[:controller].singularize.camelize.constantize rescue ActiveRecord)
  options.select { |key, value| value.is_a?(clazz) }.first.second
rescue
  nil
end 

def dynamic_route_params(options = {})
  returning [] do |dynamic_params|
    matched_routes = ActionController::Routing::Routes.routes.select do |route|
      route.matches_controller_and_action?(options[:controller], options[:action])
    end
    dynamic_segments = matched_routes.map(&amp;:segments).flatten.each do |segment|
      dynamic_params &lt;&lt; segment.key if segment.is_a?(ActionController::Routing::DynamicSegment)
    end
  end
end
</code></pre>

<p>Assim, os valores defaults dos parâmetros da rota serão obtidos diretamente do model. Caso queiram contribuir, este código está disponível no <a href="http://github.com/1up4dev/random-samples/blob/master/dynamic_route_params/dynamic_route_params.rb">github</a>.</p>

<p><strong>Referências</strong>
<a href="http://railsguts.com/routing_inside_out.html">Rails Routing from the Inside Out</a>
<a href="http://guides.rubyonrails.org/routing.html">Rails Guides: Routing</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/05/active-record-em-como-adicionar-comportamento-as-suas-associacoes/">Active Record Em: Como Adicionar Comportamento as Suas Associações</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-05-19T10:14:18-03:00" pubdate data-updated="true">May 19<span>th</span>, 2010</time>
        | 
  


  <span class="byline author vcard">Posted by <span class="fn"><a class='author' href='/author/rogerbarreto/'>Roger Leite</a></span></span>


        
         | <a href="/2010/05/active-record-em-como-adicionar-comportamento-as-suas-associacoes/#disqus_thread">Comments</a>
        
      </p>
    
    
      <br/>
      
  
  


<div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://1up4dev.org/2010/05/active-record-em-como-adicionar-comportamento-as-suas-associacoes/" data-text="Active Record em: Como adicionar comportamento as suas associações" data-via="1up4dev" data-counturl="http://1up4dev.org/2010/05/active-record-em-como-adicionar-comportamento-as-suas-associacoes/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium" data-href="http://1up4dev.org/2010/05/active-record-em-como-adicionar-comportamento-as-suas-associacoes/"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false" data-url="http://1up4dev.org/2010/05/active-record-em-como-adicionar-comportamento-as-suas-associacoes/"></div>
  
</div>

    
  </header>


  <div class="entry-content"><p>Qualquer um que comece a desenvolver com <a href="http://api.rubyonrails.org/files/vendor/rails/activerecord/README.html">Active Record</a> (AR), minha primeira recomendação é, para tudo e leia:  <a href="http://guides.rubyonrails.org/association_basics.html">A Guide to Active Record Associations</a> ou <a href="http://guias.rubyonrails.pro.br/association_basics.html">O Guia de Associações do Active Record</a>. O guia é bem completo, e descreve muito bem os tipos de associações que estão disponíveis no AR.</p>

<h2>Association Proxy, #wtf !</h2>

<p>As associações:</p>

<ul>
<li><p>belongs_to</p></li>
<li><p>has_one</p></li>
<li><p>has_many</p></li>
<li><p>has_and_belongs_to_many</p></li>
</ul>


<p>Quando usadas, adicionam alguns métodos (veja <a href="http://guides.rubyonrails.org/association_basics.html#detailed-association-reference">Detailed Association Reference</a>). Por exemplo, ao declarar uma associação <em>belongs_to</em>, o model &ldquo;ganhará&rdquo; os seguintes métodos:</p>

<ul>
<li><p>association(force_reload = false)</p></li>
<li><p>association=(associate)</p></li>
<li><p>build_association(attributes = {})</p></li>
<li><p>create_association(attributes = {})</p></li>
</ul>


<p>Onde association, será substituído pelo nome da associação. Exemplo retirado do guides:</p>

<pre><code>class Order &lt; ActiveRecord::Base
   belongs_to :customer
end
</code></pre>

<p>Cada instância de Order, conterá os métodos:</p>

<ul>
<li><p>customer</p></li>
<li><p>customer=</p></li>
<li><p>build_customer</p></li>
<li><p>create_customer</p></li>
</ul>


<p>O <em>association proxy</em>, é o objeto que faz a ligação do objeto que contém a associação, conhecido como <em>owner</em>, e o objeto associado, conhecido como <em>target</em>.</p>

<h2>Legal e daí !?!</h2>

<p>Graças ao <em>association proxy</em>, ao declarar uma associação, podemos extendê-la e adicionar comportamentos &ldquo;customizados&rdquo;. No guia, é citado como <a href="http://guides.rubyonrails.org/association_basics.html#association-extensions">Association Extensions</a>. O código de exemplo abaixo, está no github em <a href="http://github.com/rogerleite/random-samples">random-samples</a>.</p>

<p>Para exemplificar, vamos criar um modulo que adiciona o comportamento de uma galeria a qualquer coleção.</p>

<pre><code>module GalleryColletion

  def current=(curr = nil)
    @current, @index = nil

    if curr.nil?
      @current = collection.first
      @index = 0
    else
      collection.each_with_index do |item, index|
        if item.id.to_i == curr.to_i
          @current = item
          @index = index
        end
      end
    end
    @current
  end

  def current
    @current
  end

  def position
    @index + 1
  end

  def previous?
    return false if @index.nil?
    !!(@index - 1 &gt;= 0)
  end
  def previous
    collection[@index - 1] if previous?
  end

  def next?
    return false if @index.nil?
    !!(@index + 1 &lt; collection.size)
  end
  def next
    collection[@index + 1] if next?
  end

  private

  def collection
    proxy_owner.send(proxy_reflection.name)
  end

end
</code></pre>

<p><a href="http://github.com/rogerleite/random-samples/blob/master/association_extend/lib/extensions/gallery_collection.rb">Gallery Collection</a></p>

<p>Note que o modulo está na pasta lib, logo, a pasta tem que ser adicionada no path via config/environment.rb.</p>

<p>Para extender a associação, declare:</p>

<pre><code>class Article &lt; ActiveRecord::Base
  has_and_belongs_to_many :images, :extend =&gt; GalleryColletion
end
</code></pre>

<p><a href="http://github.com/rogerleite/random-samples/blob/master/association_extend/app/models/article.rb">Article model</a>, <a href="http://github.com/rogerleite/random-samples/blob/master/association_extend/app/models/image.rb">Image model aqui</a>.</p>

<p>Agora para navegar entre as imagens, você pode usar:</p>

<pre><code>a = Article.first
a.images.current = 1 #1 e o Image.id que deseja selecionar
a.images.current
a.images.position
a.images.next?
a.images.next
a.images.previous?
a.images.previous
</code></pre>

<p>Caso esteja com coragem, baixe o projeto e veja rodando.</p>

<p>Dúvidas, sugestões, algum &ldquo;case&rdquo; de sucesso, comente!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/6/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/4/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>ln -s /feed</h1>
  <br />
  <a href="http://feeds.feedburner.com/1up4developers"><img src="http://feeds.feedburner.com/~fc/1up4developers?bg=000000&amp;fg=FFFFFF&amp;anim=1" height="26" width="88" style="border:0" alt="" /></a>
</section>
<section>
  <h1>head -5 /posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014/09/integracao-continua-e-entrega-continua-de-modo-facil-com-wercker/">Integração Contínua e Entrega Contínua de modo fácil com Wercker</a>
      </li>
    
      <li class="post">
        <a href="/2014/04/alguns-truques-com-o-repl-do-clojure/">Alguns truques com o REPL do Clojure</a>
      </li>
    
      <li class="post">
        <a href="/2013/09/sowing-the-seeds-of-code/">Sowing the seeds of code</a>
      </li>
    
      <li class="post">
        <a href="/2013/09/off-topic-transforme-seu-roteador-wireless-em-um-nas-mediaserver-upnp-dlna-bittorrent-client-com-openwrt/">[Off-Topic] Transforme seu roteador wireless em um NAS, MediaServer UPnP/DLNA e BitTorrent client com OpenWRT</a>
      </li>
    
      <li class="post">
        <a href="/2013/09/quicktips-do-wordpress-para-octopress-slash-jekyll-no-github-pages/">[QuickTips] Do Wordpress para Octopress/Jekyll no GitHub Pages</a>
      </li>
    
  </ul>
</section>




<section>
  <h1>ls /authors</h1>
  <ul id="authors">
    
      
    
      
        <li class="author">
          <a href="/author/rodrigopanachi">Rodrigo Panachi</a> (36)
        </li>
      
    
      
        <li class="author">
          <a href="/author/rogerbarreto">Roger Leite</a> (33)
        </li>
      
    
      
        <li class="author">
          <a href="/author/pbalduino">Plínio Balduino</a> (15)
        </li>
      
    
      
        <li class="author">
          <a href="/author/miguelhorlle">Miguel Horlle</a> (4)
        </li>
      
    
      
        <li class="author">
          <a href="/author/andrefarina">André Farina</a> (1)
        </li>
      
    
      
        <li class="author">
          <a href="/author/hbulhoes">Humberto Bulhões</a> (8)
        </li>
      
    
      
        <li class="author">
          <a href="/author/rramos">Rogério Ramos</a> (1)
        </li>
      
    
      
        <li class="author">
          <a href="/author/tonyfabeen">Tony Fabeen</a> (2)
        </li>
      
    
  </ul>
</section>
<section>
  <h1>ls /categories</h1>
  <p class="category-list">
    
      <a class='category' href='/categories/hello/'>hello</a>&nbsp;
    
      <a class='category' href='/categories/cascata/'>cascata</a>&nbsp;
    
      <a class='category' href='/categories/processos/'>processos</a>&nbsp;
    
      <a class='category' href='/categories/waterfall/'>waterfall</a>&nbsp;
    
      <a class='category' href='/categories/questionamento/'>questionamento</a>&nbsp;
    
      <a class='category' href='/categories/real-world/'>real world</a>&nbsp;
    
      <a class='category' href='/categories/resenhas/'>resenhas</a>&nbsp;
    
      <a class='category' href='/categories/web/'>web</a>&nbsp;
    
      <a class='category' href='/categories/marketing/'>marketing</a>&nbsp;
    
      <a class='category' href='/categories/tutorial/'>tutorial</a>&nbsp;
    
      <a class='category' href='/categories/evento/'>evento</a>&nbsp;
    
      <a class='category' href='/categories/eventos/'>eventos</a>&nbsp;
    
      <a class='category' href='/categories/quick-tips/'>quick tips</a>&nbsp;
    
      <a class='category' href='/categories/projetos/'>projetos</a>&nbsp;
    
      <a class='category' href='/categories/novidades-da-semana/'>novidades da semana</a>&nbsp;
    
      <a class='category' href='/categories/rails/'>rails</a>&nbsp;
    
      <a class='category' href='/categories/ruby/'>ruby</a>&nbsp;
    
      <a class='category' href='/categories/sitefique-dot-me/'>sitefique.me</a>&nbsp;
    
      <a class='category' href='/categories/lisp/'>lisp</a>&nbsp;
    
      <a class='category' href='/categories/linux/'>linux</a>&nbsp;
    
      <a class='category' href='/categories/off-topic/'>off-topic</a>&nbsp;
    
      <a class='category' href='/categories/clojure/'>clojure</a>&nbsp;
    
      <a class='category' href='/categories/comunidade/'>comunidade</a>&nbsp;
    
      <a class='category' href='/categories/javascript/'>javascript</a>&nbsp;
    
      <a class='category' href='/categories/agile/'>agile</a>&nbsp;
    
      <a class='category' href='/categories/continuous-delivery/'>continuous delivery</a>&nbsp;
    
      <a class='category' href='/categories/continuous-integration/'>continuous integration</a>&nbsp;
    
  </p>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - 1up4developers -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>. Design by <a href="http://octopressthemes.com">Octopress Themes</a>.</span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = '1up4dev';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
