
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>1up4developers</title>
  <meta name="author" content="1up4developers authors">

  
  <meta name="description" content="Iniciando minha participação neste blog, vou apresentar uma solução rápida para um problema que eu tive e levei um certo tempo para encontrar uma &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://1up4developers.github.io/page/5">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="1up4developers" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">1up4developers</a></h1>
  
    <h2>Nadando contra o Waterfall. tail -f /mind/realworld >> /blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:1up4developers.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/usando-bundler-com-rails-2-3/">Usando Bundler Com Rails 2.3</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-17T00:00:00-02:00" pubdate data-updated="true">Jan 17<span>th</span>, 2011</time>
        
         | <a href="/2011/01/usando-bundler-com-rails-2-3/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">Iniciando minha participação neste blog, vou apresentar uma solução rápida para um problema que eu tive e levei um certo tempo para encontrar uma resposta.

Caso você não conheça, Bundler é uma ferramenta criada para facilitar a instalação e atualização de aplicações e suas gems, resolvendo facilmente as dependências e criando ambientes homogêneos em máquinas diferentes. Em outras palavras, resolve de uma vez por todas aquele inferno que era ter que baixar gem por gem da sua aplicação e ainda assim correr o risco de encontrar alguma incompatibilidade.

O Rails 3 utiliza o Bundler por padrão, mas aplicações em Rails 2.x ainda dependem das gems declaradas no arquivo <code>config/environment.rb</code>, e ao copiar os arquivos para uma determinada máquina, você é obrigado a usar <code>rake gems:install</code>, que vai levar algum tempo rodando e não vai instalar tudo o que você precisa.

Ou pelo menos era assim que funcionava até você ler esse post.

Primeiro, considerando que você esteja no diretório raiz da sua aplicação, execute a sequência abaixo:

Antes de qualquer outra coisa, instale o Bundler na sua máquina executando o comando <code>gem install bundler</code>

No seu arquivo <code>config/boot.rb</code>, imediatamente antes da linha <code>Rails.boot!</code>, insira o bloco abaixo:
<pre lang="ruby">class Rails::Boot
  def run
    load_initializer

    Rails::Initializer.class_eval do
      def load_gems
        @bundler_loaded ||= Bundler.require :default, Rails.env
      end
    end

    Rails::Initializer.run(:set_load_path)
  end
end
</pre>
Crie um arquivo <code>config/preinitializer.rb</code>. Esse arquivo não existe no Rails 2.x, então se você não criar, não vai funcionar. Adicione as linhas abaixo nesse arquivo:
<pre lang="ruby">begin
  require "rubygems"
  require "bundler"
rescue LoadError
  raise "Could not load the bundler gem. Install it with `gem install bundler`."
end

if Gem::Version.new(Bundler::VERSION) <= Gem::Version.new("0.9.24")
  raise RuntimeError, "Your bundler version is too old for Rails 2.3." +
   "Run `gem install bundler` to upgrade."
end

begin
  # Set up load paths for all bundled gems
  ENV["BUNDLE_GEMFILE"] = File.expand_path("../../Gemfile", __FILE__)
  Bundler.setup
rescue Bundler::GemNotFound
  raise RuntimeError, "Bundler couldn't find some gems." +
    "Did you run `bundle install`?"
end
</pre>
Crie um arquivo chamado <code>Gemfile</code> no raiz da sua aplicação. Entre em <code>config/environment.rb</code>, remova todas as instruções config.gem e as adicione no arquivo <code>Gemfile</code> conforme abaixo, sem o prefixo <code>config.</code> (ponto incluído).

Seu arquivo <code>config/environment.rb</code> era assim:
<pre lang="ruby"># Be sure to restart your server when you modify this file

# Specifies gem version of Rails to use when vendor/rails is not present
RAILS_GEM_VERSION = '2.3.10' unless defined? RAILS_GEM_VERSION

# Bootstrap the Rails environment, frameworks, and default configuration
require File.join(File.dirname(__FILE__), 'boot')

Rails::Initializer.run do |config|
  # Settings in config/environments/* take precedence over those specified here.
  # Application configuration should go into files in config/initializers
  # -- all .rb files in that directory are automatically loaded.

  # Add additional load paths for your own custom dirs
  # config.load_paths += %W( #{RAILS_ROOT}/extras )

  # Specify gems that this application depends on and have them installed with rake gems:install
  config.gem "bj"
  config.gem "hpricot", :version => '0.6', :source => "http://code.whytheluckystiff.net"
  config.gem "sqlite3-ruby", :lib => "sqlite3"
  config.gem "aws-s3", :lib => "aws/s3"
  config.gem "authlogic", :version => "=2.1.6"
  config.gem "slim_scrooge", "=1.0.10"

  # Only load the plugins named here, in the order given (default is alphabetical).
  # :all can be used as a placeholder for all plugins not explicitly named
  # config.plugins = [ :exception_notification, :ssl_requirement, :all ]

  # Skip frameworks you're not going to use. To use Rails without a database,
  # you must remove the Active Record framework.
  # config.frameworks -= [ :active_record, :active_resource, :action_mailer ]
end
</pre>
E agora é assim:
<pre lang="ruby"># Be sure to restart your server when you modify this file

# Specifies gem version of Rails to use when vendor/rails is not present
RAILS_GEM_VERSION = '2.3.10' unless defined? RAILS_GEM_VERSION

# Bootstrap the Rails environment, frameworks, and default configuration
require File.join(File.dirname(__FILE__), 'boot')

Rails::Initializer.run do |config|
  # Settings in config/environments/* take precedence over those specified here.
  # Application configuration should go into files in config/initializers
  # -- all .rb files in that directory are automatically loaded.

  # Add additional load paths for your own custom dirs
  # config.load_paths += %W( #{RAILS_ROOT}/extras )

  # Only load the plugins named here, in the order given (default is alphabetical).
  # :all can be used as a placeholder for all plugins not explicitly named
  # config.plugins = [ :exception_notification, :ssl_requirement, :all ]

  # Skip frameworks you're not going to use. To use Rails without a database,
  # you must remove the Active Record framework.
  # config.frameworks -= [ :active_record, :active_resource, :action_mailer ]
end
</pre>
Bem mais limpo, não?

Já o seu recém criado arquivo <code>Gemfile</code> vai ficar assim:
<pre lang="ruby">source 'http://gemcutter.org'
gem "bj"
gem "hpricot", "~> 0.6"
gem "sqlite3-ruby", "~> 1.3.1", :require => "sqlite3"
gem "aws-s3", :lib => "aws/s3"
gem "rails", "= 2.3.10"
gem "authlogic", "~> 2.1.6"

group :development, :test do
  gem 'mongrel', :require => false
end

group :production do
  gem "slim_scrooge", "~> 1.0.10"
end
</pre>
Note que eu criei dois grupos: um com <code>:development, :test</code> e um com <code>:production</code>. Significa que as gems do primeiro grupo somente serão utilizadas em desenvolvimento e em testes, e as do segundo grupo somente serão usadas no ambiente de produção. O que está fora dos grupos será usado em qualquer ambiente.

Agora, finalmente você digita <code>bundle install</code>, aguarda alguns instantes e pronto! A sua aplicação está com todas as gems instaladas e suas devidas dependências.

Para listar as gems utilizadas, execute <code>bundle list</code>.

Sugestões, correções e críticas são bem vindas nos comentários.

Para mais informações, leia a documentação no site do Bundle: <a href="http://gembundler.com/" target="_blank">http://gembundler.com/</a>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/08/teste-de-integracao-com-rspec-1-x-e-capybara-na-sua-app-rails/">Teste De Integração Com Rspec 1.x E Capybara Na Sua App Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-09T00:00:00-03:00" pubdate data-updated="true">Aug 9<span>th</span>, 2010</time>
        
         | <a href="/2010/08/teste-de-integracao-com-rspec-1-x-e-capybara-na-sua-app-rails/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">Este não é daqueles posts que explicam o que é rspec, testes, diferenças entre teste funcional, integração e etc. Este post é só uma rapidinha, pra quem já conhece <a title="Rspec home" href="http://rspec.info/">rspec</a> e <a title="capybara" href="http://github.com/jnicklas/capybara">capybara</a>.

A documentação do Capybara é boa, mas deixa a desejar nas instruções de como integrá-lo somente com rspec. Com a ajuda do <a href="http://blog.georgeguimaraes.com/">George Guimarães</a> da <a href="http://blog.plataformatec.com.br/">Plataforma</a>, cheguei num passo a passo mega simples.

No <em>config/environments/test.rb</em> declare:
<pre lang="ruby">config.gem "rspec",            :version =&gt; "= 1.3.0", :lib =&gt; false
config.gem "rspec-rails",      :version =&gt; "= 1.3.2", :lib =&gt; false
config.gem "capybara",         :version =&gt; "= 0.3.9", :lib =&gt; false</pre>
No <em>spec/spec_helper.rb</em> coloque:
<pre lang="ruby">require 'capybara/rails'
[...]
Spec::Runner.configure do |config|

  [...]
  config.include(Capybara, :type =&gt; :integration)

end</pre>
Pronto! Isto é o suficiente para utilizar o Capybara nos testes de integração.
Para finalizar, você pode montar um teste simples de validação. Por exemplo:

Crie <em>spec/integration/site_spec.rb</em> e coloque:
<pre lang="ruby">require 'spec_helper'

describe "Site sample" do

  context "root" do

    before do
      visit root_url
      save_and_open_page
    end

    it "should have Hello" do
      page.should have_content("Hello")
    end

  end

end</pre>
Para executar somente os testes de integração:
<pre>rake spec:integration</pre>
<h2>have_content e um hot tip que pode te salvar muitas horas !</h2>
Caso aconteça o erro:
<pre>undefined method `have_content' for #&lt;ActionController::Integration::Session:0xb618ad10&gt;</pre>
Graças a esta mensagem <a href="http://groups.google.com/group/ruby-capybara/browse_thread/thread/28467e031beb7ba1/19a368c21a278eb8?lnk=gst&amp;q=have_content#19a368c21a278eb8">Can&#8217;t make matchers work with cucumber and rails 2.3.2</a>, descobri que o <em>have_content</em> não funciona com o rails 2.3.2, eu resolvi o problema fazendo um upgrade para a última versão do rails. #ficaadica

Dúvidas, melhorias, sugestões e elogios são sempre bem vindos !
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/07/a-extincao-do-programador-senior/">A Extinção Do Programador Sênior</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-07-29T00:00:00-03:00" pubdate data-updated="true">Jul 29<span>th</span>, 2010</time>
        
         | <a href="/2010/07/a-extincao-do-programador-senior/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">Quando foi a última vez em que você viu um programador sênior? Eu tenho tido sérias dificuldades para encontrar algum. Acho que se estivesse procurando ararinhas azuis teria tido mais sucesso &#8211; será que alguma toparia programar? Desconfio que não. Consciente da causa ecológica, ela me diria: cada ararinha programando toma o lugar de um programador sênior, que é de uma espécie muito mais em risco do que eu. E bateria as asas em retirada.

É claro que, ao contrário da <a title="Cyanopsitta spixii" href="http://pt.wikipedia.org/wiki/Ararinha-azul" target="_blank">pobre arara</a>, o programador sênior ainda existe, e em grandes quantidades. Mas algo deu errado na evolução da sua espécie que, ao invés de melhorar, foi substituída por uma variedade mais fácil de reproduzir, bem adaptada ao cativeiro, de comportamento dócil, capaz de passar anos fazendo a mesma coisa e com duas opções de cor: terno preto ou azul. E que, curiosamente, não consegue programar. Eu já vou batizando essa variedade de <em>programador senhor</em>.

Estou falando por experiência própria. A <a href="http://www.alohapos.com.br/" target="_blank">empresa em que eu trabalho</a> está recrutando um &#8220;programador sênior&#8221; há alguns meses. Dada a indisponibilidade dos colegas no nosso <em>networking</em> (o que nos pouparia um grande tempo), resolvemos apelar e buscar no mercadão de trabalho (vulgo apinfo, catho, essas coisas). Nós filtramos dezenas de currículos, conduzimos entrevistas, aplicamos testes. Com isso, conseguimos achar diversos programadores <em>senhores</em> mas nenhum propriamente <em>sênior</em>. A maioria tinha 10+ anos de carreira, 30+ anos de idade e -1 noção para bolar respostas satisfatórias para questões como:
<ol>
	<li>Como dois programas podem se comunicar?</li>
	<li>O que são threads?</li>
	<li>Implemente o <a href="http://imranontech.com/2007/01/24/using-fizzbuzz-to-find-developers-who-grok-coding/" target="_blank">fizz buzz</a> na linguagem que preferir.</li>
</ol>
E assim por diante. Nada muito específico: preferimos encontrar gente que tivesse convivido com certos problemas, independente da tecnologia adotada. Gente demonstrasse <em>senioridade</em> propriamente dita: maturidade, bom senso, raciocínio, segurança. E conhecimento suficiente para não achar que a chave de todos os problemas é uma consulta ao Google (houve quem confessasse isso). Não encontramos essa gente ainda, mas em compensação vimos muitas pessoas bem intencionadas, certamente esforçadas, mas com imensas dificuldades para concatenar opiniões a respeito de conceitos que julgamos básicos e, no nosso negócio, fundamentais.

Sequer exigimos que o candidato conheça tópicos como controle de versão, orientação a objetos, design patterns, agilidade e etcetera, que são sinais mais do que evidentes de maturidade. Já entendemos que tudo isso está além dos limites do habitat do programador senhor. São coisas tão exóticas quanto um programador sênior genuíno, que só deve existir em áreas de proteção ambiental, como este blog.

(Às araras azuis que estiverem interessadas no recrutamento: por ora concluímos o processo, mas não deixem de <a href="mailto:humberto.bulhoes@gmail.com">entrar em contato</a>.)
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/07/gerando-rotas-com-parametros-dinamicos-no-rails-de-modo-facil/">Gerando Rotas Com Parâmetros Dinâmicos No Rails De Modo Fácil</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-07-02T00:00:00-03:00" pubdate data-updated="true">Jul 2<span>nd</span>, 2010</time>
        
         | <a href="/2010/07/gerando-rotas-com-parametros-dinamicos-no-rails-de-modo-facil/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">A <a href="http://api.rubyonrails.org/classes/ActionController/Routing.html">API de rotas</a> do Rails simplifica consideravelmente o desenvolvimento fornecendo um padrão de geração e utilização de URLs para toda aplicação. Porém algumas necessidades especificas e relativamente simples podem gerar dores de cabeça se forem implementadas incorretamente.

Um caso bastante comum são URLs compostas que sempre apontam para um mesmo recurso. Por exemplo, um blog que possua rotas para seus posts no formato <code>/posts/autor/categoria/permalink</code> provavelmente terá uma rota mapeada como <code>map.post "posts/:author/:category/:permalink"</code> gerando automaticamente os helpers <code>post_path</code> e <code>post_url</code>.

Muito bom, porém para <a href="http://guides.rubyonrails.org/routing.html#generating-urls-from-code">usufruirmos desta facilidade</a> precisamos fornecer os valores dos parâmetros dinâmicos nos <em>controllers</em> e <em>views</em>:
<pre lang="ruby">post_path(:author => @post.author, :category => @post.category, :permalink => @post.permalink)</pre>
E mesmo que você forneça os <a href="http://guides.rubyonrails.org/routing.html#route-generation-from-arrays">parâmetros em um array</a>, vai dar muito trabalho além de deixar muito código repetido pela aplicação.
<h2>Entendi! Mas como resolvo este problema?</h2>
Para este caso, apenas implementar o método <code><a href="http://api.rubyonrails.org/classes/ActiveRecord/Base.html#M001840">to_param</a></code> do model não vai servir. Uma solução seria reescrever o método <code>post_path</code> (que é gerado automaticamente) no respectivo helper (posts_helper.rb):
<pre lang="ruby">def post_path(post, options = {})
  super(post, :author => post.author, :category => post.category, :permalink => post.permalink)
end</pre>
Outra solução seria sobrescrever o método <code><a href="http://api.rubyonrails.org/classes/ActionController/Base.html#M000467">default_url_options</a></code> no <em>controller</em> para retorna os parâmetros padrões da rota:
<pre lang="ruby">def default_url_options(options = {})
  options.merge!(:author => @post.author, :category => @post.category, :permalink => @post.permalink) if options[:action] == "show"
end</pre>
A má notícia é que você terá que fazer isto para todos seus controllers e respectivos models.

A terceira solução (e mais elegante) é padronizar a maneira com que os parâmetros opcionais da rota são obtidos a partir do controller e seu respectivo model. Basta adicionar os seguintes métodos no seu <em>ApplicationController</em>:
<pre lang="ruby">def default_url_options(options = {})
  if (model = controller_model(options))
    dynamic_route_params(options).each do |param|
      options[param] = model.send(param) if model.respond_to?(param)
    end
  end
  options
end

def controller_model(options = {})
  clazz = (options[:controller].singularize.camelize.constantize rescue ActiveRecord)
  options.select { |key, value| value.is_a?(clazz) }.first.second
rescue
  nil
end 

def dynamic_route_params(options = {})
  returning [] do |dynamic_params|
    matched_routes = ActionController::Routing::Routes.routes.select do |route|
      route.matches_controller_and_action?(options[:controller], options[:action])
    end
    dynamic_segments = matched_routes.map(&:segments).flatten.each do |segment|
      dynamic_params << segment.key if segment.is_a?(ActionController::Routing::DynamicSegment)
    end
  end
end</pre>
Assim, os valores defaults dos parâmetros da rota serão obtidos diretamente do model. Caso queiram contribuir, este código está disponível no <a href="http://github.com/1up4dev/random-samples/blob/master/dynamic_route_params/dynamic_route_params.rb">github</a>.

<strong>Referências</strong>
<a href="http://railsguts.com/routing_inside_out.html">Rails Routing from the Inside Out</a>
<a href="http://guides.rubyonrails.org/routing.html">Rails Guides: Routing</a>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/05/active-record-em-como-adicionar-comportamento-as-suas-associacoes/">Active Record Em: Como Adicionar Comportamento as Suas Associações</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-05-19T00:00:00-03:00" pubdate data-updated="true">May 19<span>th</span>, 2010</time>
        
         | <a href="/2010/05/active-record-em-como-adicionar-comportamento-as-suas-associacoes/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">Qualquer um que comece a desenvolver com <a href="http://api.rubyonrails.org/files/vendor/rails/activerecord/README.html">Active Record</a> (AR), minha primeira recomendação é, para tudo e leia:  <a href="http://guides.rubyonrails.org/association_basics.html">A Guide to Active Record Associations</a> ou <a href="http://guias.rubyonrails.pro.br/association_basics.html">O Guia de Associações do Active Record</a>. O guia é bem completo, e descreve muito bem os tipos de associações que estão disponíveis no AR.
<h2>Association Proxy, #wtf !</h2>
As associações:
<ul>
	<li>belongs_to</li>
	<li>has_one</li>
	<li>has_many</li>
	<li>has_and_belongs_to_many</li>
</ul>
Quando usadas, adicionam alguns métodos (veja <a href="http://guides.rubyonrails.org/association_basics.html#detailed-association-reference">Detailed Association Reference</a>). Por exemplo, ao declarar uma associação <em>belongs_to</em>, o model &#8220;ganhará&#8221; os seguintes métodos:
<ul>
	<li>association(force_reload = false)</li>
	<li>association=(associate)</li>
	<li>build_association(attributes = {})</li>
	<li>create_association(attributes = {})</li>
</ul>
Onde association, será substituído pelo nome da associação. Exemplo retirado do guides:
<pre lang="ruby">class Order < ActiveRecord::Base
   belongs_to :customer
end</pre>
Cada instância de Order, conterá os métodos:

<span style="font-size: small;"> </span>
<ul>
	<li>customer</li>
	<li>customer=</li>
	<li>build_customer</li>
	<li>create_customer</li>
</ul>
O <em>association proxy</em>, é o objeto que faz a ligação do objeto que contém a associação, conhecido como <em>owner</em>, e o objeto associado, conhecido como <em>target</em>.
<h2>Legal e daí !?!</h2>
Graças ao <em>association proxy</em>, ao declarar uma associação, podemos extendê-la e adicionar comportamentos &#8220;customizados&#8221;. No guia, é citado como <a href="http://guides.rubyonrails.org/association_basics.html#association-extensions">Association Extensions</a>. O código de exemplo abaixo, está no github em <a href="http://github.com/rogerleite/random-samples">random-samples</a>.

Para exemplificar, vamos criar um modulo que adiciona o comportamento de uma galeria a qualquer coleção.

<pre lang="ruby">
module GalleryColletion

  def current=(curr = nil)
    @current, @index = nil

    if curr.nil?
      @current = collection.first
      @index = 0
    else
      collection.each_with_index do |item, index|
        if item.id.to_i == curr.to_i
          @current = item
          @index = index
        end
      end
    end
    @current
  end

  def current
    @current
  end

  def position
    @index + 1
  end

  def previous?
    return false if @index.nil?
    !!(@index - 1 >= 0)
  end
  def previous
    collection[@index - 1] if previous?
  end

  def next?
    return false if @index.nil?
    !!(@index + 1 < collection.size)
  end
  def next
    collection[@index + 1] if next?
  end

  private

  def collection
    proxy_owner.send(proxy_reflection.name)
  end

end
</pre>
<a href="http://github.com/rogerleite/random-samples/blob/master/association_extend/lib/extensions/gallery_collection.rb">Gallery Collection</a>

Note que o modulo está na pasta lib, logo, a pasta tem que ser adicionada no path via config/environment.rb.

Para extender a associação, declare:

<pre lang="ruby">
class Article < ActiveRecord::Base
  has_and_belongs_to_many :images, :extend => GalleryColletion
end
</pre>
<a href="http://github.com/rogerleite/random-samples/blob/master/association_extend/app/models/article.rb">Article model</a>, <a href="http://github.com/rogerleite/random-samples/blob/master/association_extend/app/models/image.rb">Image model aqui</a>.

Agora para navegar entre as imagens, você pode usar:
<pre lang="ruby">a = Article.first
a.images.current = 1 #1 e o Image.id que deseja selecionar
a.images.current
a.images.position
a.images.next?
a.images.next
a.images.previous?
a.images.previous</pre>
Caso esteja com coragem, baixe o projeto e veja rodando.

Dúvidas, sugestões, algum &#8220;case&#8221; de sucesso, comente!
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/05/teste-sua-aplicacao-de-linha-de-comando-com-cucumber/">Teste Sua Aplicação De Linha De Comando Com Cucumber!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-05-14T00:00:00-03:00" pubdate data-updated="true">May 14<span>th</span>, 2010</time>
        
         | <a href="/2010/05/teste-sua-aplicacao-de-linha-de-comando-com-cucumber/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">É engraçado como tudo é questão de treino e disciplina. Levei um tempo para me acostumar com <a href="http://en.wikipedia.org/wiki/Test-driven_development">TDD</a>, <a href="http://www.vim.org/">Vim</a> e não poderia ser diferente com testes funcionais, sendo mais especifico, <a href="http://cukes.info/">Cucumber</a>.

Até o momento, só tinha usado cucumber em projetos web. E quando voltei a desenvolver o <a href="http://github.com/rogerleite/rubygems_snapshot">rubygems_snapshot</a>, senti falta de algo para testar funcionalmente. Baseado no <a href="http://github.com/vertiginous/pik">pik</a>, montei um esquema simples para validar qualquer aplicação de linha de comando.
<h2>Como instalar</h2>
Basicamente, será necessário (fontes via gist):
<ul>
	<li>rake para executar o cucumber</li>
	<li>env_terminal.rb</li>
	<li>terminal_steps.rb</li>
</ul>
<script src="http://gist.github.com/400069.js"></script>

Dado que você tem cucumber instalado, com o esquema da pasta &#8220;features&#8221;.
<ul>
	<li>Copie o cucumber.rake para a raiz.</li>
	<li>Copie o env_terminal.rb para a pasta features.</li>
	<li>Copie o terminal_steps.rb para a pasta features/step_definitions/terminal_steps.rb.</li>
	<li>Edite o  env.rb incluindo (pode ser no começo):</li>
</ul>
<pre>require "env_terminal"</pre>
<ul>
	<li>Dentro do Rakefile, pode ser no final mesmo, adicione:</li>
</ul>
<pre>load "cucumber.rake"</pre>
<h2>Como usar</h2>
Todas features:
<pre>rake cucumber</pre>
Features com a tag @wip, também conhecida como Work in Progress.
<pre>rake cucumber:wip</pre>
<h2>Informações Extras</h2>
Caso precise de mais informações, você tem a opção de ver a saída dos comandos, executando a rake assim:
<pre>rake cucumber show_output=true</pre>
ou
<pre>rake cucumber:wip show_output=true</pre>
No caso do snapshot, tive a necessidade de &#8220;modificar&#8221; o comando gem toda vez que era executado, ou melhor, passar um parâmetro para controlar o ambiente. Dentro do env_terminal.rb, existe o método <strong>gsub_command</strong>, nele você pode &#8220;redefinir&#8221; comandos, caso necessite.
<h2><strong>Gostei, quero mais!</strong></h2>
A solução acima, é bem &#8220;caseira&#8221;. Para projetos simples com funcionalidades simples, funciona bem.

Caso queira algo mais robusto, você tem a opção da <a href="http://github.com/aslakhellesoy/aruba">gem Aruba</a>.

Tem este post como introdução:

<a href="http://www.themodestrubyist.com/2010/04/22/aruba---cucumber-goodness-for-the-command-line/">Aruba - Cucumber Goodness for the Command-Line</a>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/05/rubygems-snapshot-importandoexportando-gems-com-velocidade/">Rubygems Snapshot! Importando/Exportando Gems Com Velocidade!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-05-10T00:00:00-03:00" pubdate data-updated="true">May 10<span>th</span>, 2010</time>
        
         | <a href="/2010/05/rubygems-snapshot-importandoexportando-gems-com-velocidade/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">Nova versão do <a href="http://github.com/rogerleite/rubygems_snapshot">Rubygems_Snapshot</a> no ar!

Fico feliz em dizer que este é o meu primeiro projeto que passou dos dez &#8220;watchers&#8221; ! :D E que realmente ajudou alguns developers mundo afora.

A primeira versão foi muito focada no uso pessoal, como &#8220;quebra-galho&#8221; mesmo. Resolvi investir algum tempo e praticamente refaze-lá, pois ao usar no dia-a-dia percebi algumas falhas e dificuldades de uso.

Basicamente, nesta nova versão:

- É possível trabalhar com mais de um formato. Yml e Tar, que é o padrão.

- Ao exportar, os arquivos &#8220;.gem&#8221; serão exportados.

- Ao importar, ocorre praticamente uma instalação &#8220;offlline&#8221;, muito mais rápido e livre de problemas com &#8220;sources&#8221; do rubygem !

- Usar o Snapshot como API !

Como tive um trabalhão para deixar o Readme legal, não pretendo escrever mais que isso! :D

<a href="http://github.com/nofxx">Marcos</a>, valeu pelo incentivo! Cara, forka lá e manda bala!
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/12/importando-e-exportando-suas-gems-com-rubygems-snapshot/">Importando E Exportando Suas Gems Com Rubygems Snapshot</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-22T00:00:00-02:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2009</time>
        
         | <a href="/2009/12/importando-e-exportando-suas-gems-com-rubygems-snapshot/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">Final de ano está rendendo.
O <a href="http://github.com/rogerleite/rubygems_snapshot">rubygems_snapshot</a> nasceu da necessidade de &#8220;migrar&#8221; as gems instaladas de uma máquina para outra, aliado ao <a href="http://rvm.beginrescueend.com/">rvm</a> (veja este <a href="http://www.nuxlli.com.br/2009/11/24/para-tudo-instale-o-rvm-antes/">post-guia-rápido</a>), permite mudar e/ou criar diferentes ambientes em minutos. Assim você pode fugir do <span style="text-decoration: line-through;">famoso</span> &#8220;gem hell&#8221;.

Veja como é difícil usar:

Instalação:
<pre>sudo gem install rubygems_snapshot</pre>
Para <strong>exportar</strong> as gems instaladas:
<pre>gem snapshot export projeto-exemplo.yml</pre>
Supondo que esteja em outra máquina, para <strong>importar</strong> as gems, use:
<pre>[sudo] gem snapshot import projeto-exemplo.yml</pre>
<h2>Afinal, o que tem de legal nisso?</h2>
Vamos supor que você acaba de entrar numa nova equipe e tem que montar o ambiente de desenvolvimento (por sinal, um ambiente complicado de configurar). O gem snapshot aliada ao rvm, foi feito para facilitar isto, vamos a um exemplo rápido:

Com o rvm, você pode criar um &#8220;novo ambiente&#8221;:
<pre>rvm use 1.8.7%projeto_exemplo</pre>
<pre>gem list</pre>
Deve retornar vazio.
<pre>gem install rubygems_snapshot</pre>
<pre>gem snapshot import projeto-exemplo.yml</pre>
Instalará as gems necessárias para o projeto e pronto!
<h2>ToDo:</h2>
Esta é uma versão bem básica, onde o &#8220;import&#8221; somente lê as gem e version e manda instalar sem requerir dependências. Está previsto de colocar um aviso no final das gems que deram erro, geralmente devido a dependências de &#8220;build nativos&#8221;, mas por enquanto estamos usando aqui na equipe com sucesso.
<h2>Como faço para criar um rubygems plugin também?</h2>
Bom, logo de cara posso te garantir que não é difícil (apesar da pouca documentação na internet), mas deixarei os detalhes para um outro post. Por enquanto, a minha recomendação é: clone o projeto, analise os dois rb do projeto :D e crie o seu!

Caso algum corajoso for usar, estou a disposição para ajudar, é só deixar um comentário aê!
Valeu e sucesso!
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/12/agile-enterprise-edition/">Agile Enterprise Edition</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-21T00:00:00-02:00" pubdate data-updated="true">Dec 21<span>st</span>, 2009</time>
        
         | <a href="/2009/12/agile-enterprise-edition/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">Para começar o post, segue esta história sobre <em>gerenciamento</em> que vi no blog do <a href="http://gustavoribeiro.com/blog/gerenciamento" target="_blank">Gustavo Ribeiro</a>:
<blockquote>Todos os dias, uma formiga chegava cedinho ao escritório e pegava duro no trabalho. A formiga era produtiva e feliz. O gerente marimbondo estranhou a formiga trabalhar sem supervisão. Se ela era produtiva sem supervisão, seria ainda mais se fosse supervisionada.

E colocou uma barata, que preparava belíssimos relatórios e tinha muita experiência, como supervisora. A primeira preocupação da barata foi a de padronizar o horário de entrada e saída da formiga.

Logo, a barata precisou de uma secretária para ajudar a preparar os relatórios e contratou também uma aranha para organizar os arquivos e controlar as ligações telefônicas.

O marimbondo ficou encantado com os relatórios da barata e pediu também gráficos com indicadores e análise das tendências que eram mostradas em reuniões.

A barata, então, contratou uma mosca, e comprou um computador com impressora colorida. Logo, a formiga produtiva e feliz, começou a se lamentar de toda aquela movimentação de papéis e reuniões!
O marimbondo concluiu que era o momento de criar a função de gestor para a área onde a formiga produtiva e feliz, trabalhava. O cargo foi dado a uma cigarra, que mandou colocar carpete no seu escritório e comprar uma cadeira especial.

A nova gestora cigarra logo precisou de um computador e de uma assistente (sua assistente na empresa anterior) para ajudá-la a preparar um plano estratégico de melhorias e um controle do orçamento para a área onde trabalhava a formiga, que já não cantarolava mais e cada dia se tornava mais chateada.

A cigarra, então, convenceu o gerente marimbondo, que era preciso fazer um estudo de clima. Mas, o marimbondo, ao rever as cifras, se deu conta de que a unidade na qual a formiga trabalhava já não rendia como antes e contratou a coruja, uma prestigiada consultora, muito famosa, para que fizesse um diagnóstico da situação. A coruja permaneceu três meses nos escritórios e emitiu um volumoso relatório, com vários volumes que concluía: &#8220;Há muita gente nesta empresa!&#8221;

Então o marimbondo mandou demitir a formiga porque ela andava muito desmotivada e aborrecida.</blockquote>
Então lembrei de uma imagem que ilustra perfeitamente esta fábula e retrata fielmente a &#8220;organização&#8221; de alguma empresas:
<p style="text-align: center;"><a href="http://1up4dev.org/wp-content/uploads/2009/07/trabalho_em_equipe.jpg"><img class="aligncenter" title="trabalho_em_equipe" src="http://1up4dev.org/wp-content/uploads/2009/07/trabalho_em_equipe-222x300.jpg" alt="" width="222" height="300" /></a></p>

<h2>Dividir para conquistar: você está fazendo isso errado!</h2>
Quando uma <em>startup</em> passa a vender mais e ter uma procura maior por seus produtos/serviços (o que é bom), uma reação comum da &#8220;cúpula&#8221; é aumentar o quadro de funcionários visando atender a demanda. Logo surgem os problemas com a organização do pessoal e/ou fluxo de trabalho. A solução mais simplista (e óbvia) é a especialização: fulano faz isso, ciclano faz aquilo, e beltrano gerencia. Logo controles são criados, fluxos validados, centros de custo, documentos, reuniões, atas, comitês, gestão de pessoas e relacionamento, terceirização, cargos, departamentos&#8230; e nasce o monstro da <a href="http://pt.wikipedia.org/wiki/Burocracia">burocracia</a>, aka &#8220;enterprise&#8221;.

Com essa <a href="http://en.wikipedia.org/wiki/Enterprise_architecture">especialização</a>, cada &#8220;módulo&#8221; (também conhecido como departamento) começa a perder o foco no GRANDE objetivo da empresa e passa a defender apenas <a href="http://1up4dev.org/2008/11/os-guardioes-da-cascata">seus interesses</a> - a famosa MISSÃO da empresa passa a ser coadjuvante. O resultado? A empresa dobra ou triplica seu quadro de funcionários e na maioria dos casos, seu lucro bruto. Porém agora tem mais despesas com pessoal e gastos extras para manter  esse novo modelo &#8220;enterprise&#8221;. Trocando em miúdos, continua na mesma!

Onde está o erro? Mais uma vez o FOCO está na <a href="http://1up4dev.org/2008/11/foco-no-problema/">solução</a> ao invés de PROBLEMA. Se você ler meus posts anteriores vai ver que este é um tema recorrente. Então por que as empresas continuam fazendo as coisas erradas e cometendo os mesmos erros?

<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="425" height="344" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="src" value="http://www.youtube.com/v/R47Xe8kVrv0&amp;hl=pt_BR&amp;fs=1&amp;" /><param name="allowfullscreen" value="true" /><embed type="application/x-shockwave-flash" width="425" height="344" src="http://www.youtube.com/v/R47Xe8kVrv0&amp;hl=pt_BR&amp;fs=1&amp;" allowscriptaccess="always" allowfullscreen="true"></embed></object>

Idéias criativas surgem das pessoas <a href="http://blog.aspercom.com.br/2008/07/21/hierarquias-sao-inteligentes-nas-pontas/">diretamente</a> relacionadas com os problemas e não de diretores, contadores, gestores, etc. Esse modelo &#8220;enterprise&#8221; é um <em>overhead</em> organizacional que só gera ruído e desperdício!
<h2>A solução é adotar agile!</h2>
SOLUÇÃO!? Mas qual era o PROBLEMA mesmo!? Sim, mais uma vez o foco é a <a href="http://agilesoftwaredevelopment.com/blog/janusz-gorycki/agile-dead">solução</a> ao invés do problema.

Como eu disse nos posts anteriores, acreditar que uma mudança drástica do processo pode mudar a cultura da empresa e pincipalmente as pessoas é o maior erro na adoção de metodologias ágeis. Mudam o processo mas não mudam as pessoas.

De uma forma simples e direta, agile resume-se a quatro valores:
<blockquote>Individuals and interactions over processes and tools
Working software over comprehensive documentation
Customer collaboration over contract negotiation
Responding to change over following a plan</blockquote>
Ou seja, pessoas, software, colaboração e feedback. Simples assim!

O manifesto ágil não cita nada sobre &#8220;enterprise&#8221;, sobre a implementação. Este é o grande desafio em sua adoção. Como seguir estes valores sem burocratizar e engessar o processo? Como criar uma relação de colaboração com os clientes? Como responder rapidamente a mudanças? Como eliminar o esforço que não agrega valor ao produto e/ou empresa? Como evitar politicagem?
<h2>Mantenha-se pequeno!</h2>
Otimize! Busque soluções para os problemas que impedem de produzir mais e com mais qualidade. Faça MAIS com MENOS. Foque no O QUE ao invés do COMO. Escale as pessoas verticalmente!

Inove! Não espere conseguir resultados diferentes fazendo sempre a mesma coisa. Busque novidades, opniões, experiências. Ouça seus funcionários, seus clientes. Estude, pesquise, arrisque, erre, acerte&#8230; continuamente.

Mantenha o foco! Tenha um GRANDE e único objetivo e certifique-se que todos acreditem nesta filosofia. É importante que todos comprem a idéia e o <em>modus operandis</em>.

Finalizando, este é apenas meu ponto de vista, baseado na minha experiência em diversas empresas grandes e pequenas, vivenciando problemas, errando muito e principalmente aprendendo com os erros dos outros. Agilidade pode funcionar bem em grandes corporações, desde que haja foco e que todos comprem a idéia. Você pode concordar ou não.
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/12/ruby-rubygems-e-load_path-ou-como-funciona-o-require-de-gems/">Ruby, Rubygems E $LOAD_PATH Ou Como Funciona O Require De Gems</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-17T00:00:00-02:00" pubdate data-updated="true">Dec 17<span>th</span>, 2009</time>
        
         | <a href="/2009/12/ruby-rubygems-e-load_path-ou-como-funciona-o-require-de-gems/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">Na madrugada passada, andei &#8220;brincando&#8221; com o fonte do <a href="http://rubyforge.org/projects/rubygems/">Rubygems</a>. Logo de cara posso te dizer que não consegui fazer o que queria, e pra amenizar o sentimento de &#8220;perda de tempo&#8221;, resolvi postar alguns truques aprendidos.
<h2>Baixei o fonte do rubygems, como faço pra rodá-lo sem alterar o meu sistema?</h2>
Foi a primeira pergunta que fiz. Percebi que com o google não iria encontrar a resposta, mas consegui uma dica importante: $LOAD_PATH.
<pre>$ irb</pre>
<pre>irb(main):001:0&gt; $LOAD_PATH</pre>
No meu Ubuntu, obtive:
<pre>["/usr/local/lib/site_ruby/1.8", "/usr/local/lib/site_ruby/1.8/i486-linux", "/usr/local/lib/site_ruby/1.8/i386-linux", "/usr/local/lib/site_ruby", "/usr/lib/ruby/vendor_ruby/1.8", "/usr/lib/ruby/vendor_ruby/1.8/i486-linux", "/usr/lib/ruby/vendor_ruby", "/usr/lib/ruby/1.8", "/usr/lib/ruby/1.8/i486-linux", "/usr/lib/ruby/1.8/i386-linux", "."]</pre>
<pre>$ ls /usr/local/lib/site_ruby/1.8/</pre>
Exatamente nesta pasta que se encontra o rubygems.rb. Bingo!
Para rodar o fonte do rubygems, só é necessário adicionar ao $LOAD_PATH a pasta lib do projeto. Dado que estou na raiz do projeto rubygems baixado, execute:
<pre>~/rubygems$ ruby -I $PWD/lib ./bin/gem -v</pre>
O paramêtro -I permite adicionar diretório ao $LOAD_PATH. Simples e prático. Primeiro problema resolvido, comecei a programar.
<h2>Afinal, como funciona o &#8220;require de gems&#8221;?</h2>
Bom, já sabemos que o require &#8220;rubygems&#8221; fuciona pois encontra-se no $LOAD_PATH do ruby, no caso do meu Ubuntu em &#8220;/usr/local/lib/site_ruby/1.8&#8221;.

Basicamente (e muito), o Rubygems faz duas coisas no Kernel do Ruby.
<ul>
	<li>Adiciona o metodo Kernel#gem.</li>
	<li>Faz um <a href="http://en.wikipedia.org/wiki/Monkey_patch">Monkey Patch</a> no Kernel#require</li>
</ul>
<h3>Kernel#gem</h3>
Permite &#8220;acionar&#8221; uma versão específica de gem. Note que este acionar, traduz-se para, adicionar a lib da gem no $LOAD_PATH. Segue um trecho do comentário do Kernel#gem:
<p style="padding-left: 30px;">##</p>
<p style="padding-left: 30px;"># Use Kernel#gem to activate a specific version of +gem_name+.</p>
<p style="padding-left: 30px;">#</p>
<p style="padding-left: 30px;"># +version_requirements+ is a list of version requirements that the</p>
<p style="padding-left: 30px;"># specified gem must match, most commonly &#8220;= example.version.number&#8221;.  See</p>
<p style="padding-left: 30px;"># Gem::Requirement for how to specify a version requirement.</p>
<p style="padding-left: 30px;">#</p>
<p style="padding-left: 30px;"># If you will be activating the latest version of a gem, there is no need to</p>
<p style="padding-left: 30px;"># call Kernel#gem, Kernel#require will do the right thing for you.</p>
<p style="padding-left: 30px;">#</p>
<p style="padding-left: 30px;"># Kernel#gem returns true if the gem was activated, otherwise false.  If the</p>
<p style="padding-left: 30px;"># gem could not be found, didn&#8217;t match the version requirements, or a</p>

<p style="padding-left: 30px;"># different version was already activated, an exception will be raised.
[&#8230;]
<h3>Kernel#require</h3>
No final do rubygems.rb encontramos:

if RUBY_VERSION &lt; &#8216;1.9&#8217; then

require &#8216;rubygems/custom_require&#8217;

end

Não consegui descobrir o que acontece com o ruby 1.9, mas no 1.8, o monkey patch executa os seguintes passos:
<ul>
	<li>Chama o &#8220;original&#8221; require;</li>
	<li>Em caso de LoadError;
<ul>
	<li>Executa o &#8220;Gem.searcher.find(path)&#8221;;</li>
	<li>Se <em>true</em>
<ul>
	<li>Chama o activate (novamente traduz-se para adiciona a gem no $LOAD_PATH)</li>
	<li>Executa o &#8220;original&#8221; require novamente;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Exemplos com o IRB</h3>
Para finalizar legal e comprovar tudo isso, fiz alguns testes:
<pre>$ gem list json</pre>
<p style="padding-left: 30px;">*** LOCAL GEMS ***</p>
<p style="padding-left: 30px;">json (1.2.0, 1.1.9)</p>
<p style="padding-left: 30px;">json_pure (1.2.0)</p>
<p style="padding-left: 30px;"></p>

<pre>$ irb</pre>
<pre>irb(main):001:0&gt; $LOAD_PATH</pre>
<p style="padding-left: 30px;">=&gt; [&#8220;/usr/local/lib/site_ruby/1.8&#8221;, &#8220;/usr/local/lib/site_ruby/1.8/i486-linux&#8221;, &#8220;/usr/local/lib/site_ruby/1.8/i386-linux&#8221;, &#8220;/usr/local/lib/site_ruby&#8221;, &#8220;/usr/lib/ruby/vendor_ruby/1.8&#8221;, &#8220;/usr/lib/ruby/vendor_ruby/1.8/i486-linux&#8221;, &#8220;/usr/lib/ruby/vendor_ruby&#8221;, &#8220;/usr/lib/ruby/1.8&#8221;, &#8220;/usr/lib/ruby/1.8/i486-linux&#8221;, &#8220;/usr/lib/ruby/1.8/i386-linux&#8221;, &#8220;.&#8221;]</p>

<pre>irb(main):004:0&gt; require "json"</pre>
<p style="padding-left: 30px;">LoadError: no such file to load &#8211; json</p>
<p style="padding-left: 30px;">from (irb):4:in `require&#8217;</p>
<p style="padding-left: 30px;">from (irb):4</p>
<p style="padding-left: 30px;">from :0</p>

<pre>irb(main):005:0&gt; gem "json", "= 1.2.0"</pre>
<p style="padding-left: 30px;">NoMethodError: undefined method `gem&#8217; for main:Object</p>

<p style="padding-left: 30px;">from (irb):5
from :0

O require &#8220;json&#8221; por si só, carrega a versão mais atual da gem.
<pre>irb(main):006:0&gt; require "rubygems"</pre>
=&gt; true
<pre>irb(main):007:0&gt; require "json"</pre>
=&gt; true
<pre>irb(main):008:0&gt; JSON::VERSION</pre>
=&gt; &#8220;1.2.0&#8221;
<pre>irb(main):009:0&gt; $LOAD_PATH</pre>
=&gt; [&#8220;/usr/lib/ruby/gems/1.8/gems/gemcutter-0.1.8/lib&#8221;, &#8220;/usr/lib/ruby/gems/1.8/gems/json-1.2.0/bin&#8221;, &#8220;/usr/lib/ruby/gems/1.8/gems/json-1.2.0/ext/json/ext&#8221;, &#8220;/usr/lib/ruby/gems/1.8/gems/json-1.2.0/ext&#8221;, &#8220;/usr/lib/ruby/gems/1.8/gems/json-1.2.0/lib&#8221;, &#8220;/usr/local/lib/site_ruby/1.8&#8221;, &#8220;/usr/local/lib/site_ruby/1.8/i486-linux&#8221;, &#8220;/usr/local/lib/site_ruby/1.8/i386-linux&#8221;, &#8220;/usr/local/lib/site_ruby&#8221;, &#8220;/usr/lib/ruby/vendor_ruby/1.8&#8221;, &#8220;/usr/lib/ruby/vendor_ruby/1.8/i486-linux&#8221;, &#8220;/usr/lib/ruby/vendor_ruby&#8221;, &#8220;/usr/lib/ruby/1.8&#8221;, &#8220;/usr/lib/ruby/1.8/i486-linux&#8221;, &#8220;/usr/lib/ruby/1.8/i386-linux&#8221;, &#8220;.&#8221;]
<pre>irb(main):010:0&gt; quit</pre>
Após o require &#8220;json&#8221;, as pastas foram adicionadas no $LOAD_PATH.
<pre>"/usr/lib/ruby/gems/1.8/gems/json-1.2.0/bin", "/usr/lib/ruby/gems/1.8/gems/json-1.2.0/ext/json/ext", "/usr/lib/ruby/gems/1.8/gems/json-1.2.0/ext", "/usr/lib/ruby/gems/1.8/gems/json-1.2.0/lib"</pre>
Agora olhe que <strong>interessante</strong> este <strong>último teste</strong>:
<pre>$ irb

irb(main):001:0&gt; require "rubygems"</pre>
=&gt; true
<pre>irb(main):002:0&gt; $LOAD_PATH</pre>
=&gt; [&#8220;/usr/lib/ruby/gems/1.8/gems/gemcutter-0.1.8/lib&#8221;, &#8220;/usr/local/lib/site_ruby/1.8&#8221;, &#8220;/usr/local/lib/site_ruby/1.8/i486-linux&#8221;, &#8220;/usr/local/lib/site_ruby/1.8/i386-linux&#8221;, &#8220;/usr/local/lib/site_ruby&#8221;, &#8220;/usr/lib/ruby/vendor_ruby/1.8&#8221;, &#8220;/usr/lib/ruby/vendor_ruby/1.8/i486-linux&#8221;, &#8220;/usr/lib/ruby/vendor_ruby&#8221;, &#8220;/usr/lib/ruby/1.8&#8221;, &#8220;/usr/lib/ruby/1.8/i486-linux&#8221;, &#8220;/usr/lib/ruby/1.8/i386-linux&#8221;, &#8220;.&#8221;]
<pre>irb(main):003:0&gt; gem "json", "= 1.1.9"</pre>
=&gt; true
<pre>irb(main):004:0&gt; $LOAD_PATH</pre>
=&gt; [&#8220;/usr/lib/ruby/gems/1.8/gems/gemcutter-0.1.8/lib&#8221;, &#8220;/usr/lib/ruby/gems/1.8/gems/json-1.1.9/bin&#8221;, &#8220;/usr/lib/ruby/gems/1.8/gems/json-1.1.9/ext/json/ext&#8221;, &#8220;/usr/lib/ruby/gems/1.8/gems/json-1.1.9/ext&#8221;, &#8220;/usr/lib/ruby/gems/1.8/gems/json-1.1.9/lib&#8221;, &#8220;/usr/local/lib/site_ruby/1.8&#8221;, &#8220;/usr/local/lib/site_ruby/1.8/i486-linux&#8221;, &#8220;/usr/local/lib/site_ruby/1.8/i386-linux&#8221;, &#8220;/usr/local/lib/site_ruby&#8221;, &#8220;/usr/lib/ruby/vendor_ruby/1.8&#8221;, &#8220;/usr/lib/ruby/vendor_ruby/1.8/i486-linux&#8221;, &#8220;/usr/lib/ruby/vendor_ruby&#8221;, &#8220;/usr/lib/ruby/1.8&#8221;, &#8220;/usr/lib/ruby/1.8/i486-linux&#8221;, &#8220;/usr/lib/ruby/1.8/i386-linux&#8221;, &#8220;.&#8221;]
<pre>irb(main):005:0&gt; JSON</pre>
NameError: uninitialized constant JSON
from (irb):5
<pre>irb(main):006:0&gt; require "json"</pre>
=&gt; true
<pre>irb(main):007:0&gt; JSON::VERSION</pre>
=&gt; &#8220;1.1.9&#8221;
<pre>irb(main):008:0&gt; quit</pre>
Note que após o gem &#8220;json&#8221;, &#8220;= 1.1.9&#8221; &#8230; a versao 1.1.9 foi adicionada no $LOAD_PATH mas não foi carregada. Ao executar o require &#8220;json&#8221;, como este já estava no $LOAD_PATH, a versão 1.1.9 é usada.

Espero que com estas explicações, você use com mais segurança o rubygems.
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/6/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/4/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/08/introducao-a-linux-control-groups-cgroups/">Introdução a Linux Control Groups (CGroups)</a>
      </li>
    
      <li class="post">
        <a href="/2013/08/extendendo-ruby-com-c-so-um-aperitivo/">Extendendo Ruby Com C - Só Um Aperitivo</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/entendendo-lisp-finalmente/">Entendendo LISP, Finalmente.</a>
      </li>
    
      <li class="post">
        <a href="/2013/06/quicktips-usando-shell-script-como-suite-de-teste/">[QuickTips] Usando Shell Script Como Suite De Teste</a>
      </li>
    
      <li class="post">
        <a href="/2013/05/a-melhor-linguagem-de-programacao/">A Melhor Linguagem De Programação</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - 1up4developers authors -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = '1up4developers';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
